YUI.add("gallery-bt-photogrid",function(e,t){var n="widthChange",r="columnWidthChange",i="renderFinished",s=100,o="bpg_",u={COLUMN:o+"column",MODULE:o+"module"},a={COLUMN:'<div class="'+u.COLUMN+'"></div>'},f={vertical:1,horizontal:1},l=e.Base.create("btphotogrid",e.Widget,[e.Bottle.SyncScroll],{initializer:function(){this.parseImageData(),this.set("syncScrollMethod",this._updateColumns),this.publish(i),this._bpgEventHandlers=this.after(r,this._updateColumns)},destructor:function(){this._bpgEventHandlers.detach(),delete this._bpgEventHandlers},renderUI:function(){this._updateColumns(!0)},append:function(t){var n=e.Node.create(t);this.parseImageData(n.getDOMNode().nodeType==11?e.Node.create("<div>"+t+"</div>"):n,!0),this.renderImages(!0)},parseImageData:function(t,n){var r=n?this._bpgImages:[],i=this,s=this.get("photoNode"),o=t||this.get("contentBox");n||(this._bpgPending=0),o.all(this.get("moduleNode")).each(function(t){var n={icon:t.getData("icon"),img:t.getData("img"),width:t.getData("width"),height:t.getData("height"),module:t.addClass(u.MODULE),error:!1},o=t.one(s);if(!n.icon)return;n.load=e.Node.create('<img src="'+n.icon+'" />'),o?o.append(n.load):t.insert(n.load,0);if(!n.height||!n.width)this._bpgPending+=1,n.load.once("load",function(t){var r=t.target;e.UA.ie?(n.loadie=new Image,n.loadie.src=n.icon,this.height=this.loadie.height,this.width=this.loadie.width):(this.height=r.get("height"),this.width=r.get("width")),i._bpgPending-=1},n),n.load.once("error",function(e){this.error=!0,i._bpgPending-=1},n);r.push(n)},this),this._bpgImages=r},_minColumn:function(){var e=9999,t;return this.get("contentBox").all("> div").each(function(n){var r=n.get("offsetHeight");r<e&&(e=r,t=n)}),t},renderImages:function(t){var n,r=s;if(t&&this._bpgRendering)return;this._bpgRendering=!0;if(this._bpgImages.length<=this._bpgRendered){this._bpgRendering=!1,this.syncScroll(),this.fire(i);return}n=this._bpgImages[this._bpgRendered];if(n.width||n.error)n.error&&n.load.setAttribute("src",this.get("errorImage")),this._minColumn().append(n.module),this._bpgRendered+=1,r=1;e.later(r,this,this.renderImages)},_updateColumns:function(e){var t=this.get("contentBox"),n=t.get("offsetWidth"),r=this.get("columnWidth"),i=Math.round(n/r),s=Math.floor(n/i),o=n-s*(i-1),u=a.COLUMN,f=e||this._bpgColumns!==i,l;if(f){t.all(this.get("moduleNode")).remove(),t.set("innerHTML",""),this._bpgColumns=i;for(l=0;l<i;l++)t.append(u)}t.all("> div").each(function(e,t){e.set("offsetWidth",t?s:o)}),this.syncScroll(),f&&(this._bpgRendered=0,this.renderImages(!0))}},{ATTRS:{errorImage:{value:"http://l.yimg.com/f/i/tw/map/i/cpx.gif",validator:e.Lang.isString},columnWidth:{value:200,validator:function(e){return e*1>0},setter:function(e){return e*1}},gridType:{value:"vertical",validator:function(e){return f[e]?!0:!1}},moduleNode:{value:"> div",validator:e.Lang.isString},photoNode:{value:".img",validator:e.Lang.isString}},HTML_PARSER:{errorImage:function(e){return e.getData("error-image")},columnWidth:function(e){return e.getData("column-width")},gridType:function(e){return e.getData("grid-type")},moduleNode:function(e){return e.getData("module-node")},photoNode:function(e){return e.getData("photo-node")}}});e.namespace("Bottle").PhotoGrid=l},"gallery-2012.12.05-21-01",{requires:["gallery-bt-syncscroll"]});
