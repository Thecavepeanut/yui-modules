YUI.add("gallery-formmgr",function(B){function I(L,K){if(arguments.length===0){return;}if(!K){K={};}this.form_name=L;this.status_node=B.one(K.status_node);this.enabled=true;this.default_value_map=K.default_value_map;this.validation={fn:{},regex:{}};this.validation_msgs={};this.has_messages=false;this.has_errors=false;this.button_list=[];this.user_button_list=[];this.has_file_inputs=false;}var C="(?:^|\\s)(?:";var G=")(?:\\s|$)";I.required_class="yiv-required";I.length_class_re=/(?:^|\s+)yiv-length:\[([0-9]+)?,([1-9][0-9]*)?\](?:\s+|$)/;I.integer_class_re=/(?:^|\s+)yiv-integer(?::\[([-+]?[0-9]+)?,([-+]?[0-9]+)?\])?(?:\s+|$)/;I.decimal_class_re=/(?:^|\s+)yiv-decimal(?::\[([-+]?(?:[0-9]+\.?|[0-9]+\.[0-9]+|\.[0-9]+))?,([-+]?(?:[0-9]+\.?|[0-9]+\.[0-9]+|\.[0-9]+))?\])?(?:\s+|$)/;I.integer_value_re=/^[-+]?[0-9]+$/;I.decimal_value_re=/^[-+]?(?:[0-9]+\.?|[0-9]*\.[0-9]+)$/;I.row_marker_class="formmgr-row";I.status_none_class="formmgr-status-hidden";I.status_success_class="formmgr-status-success";I.status_failure_class="formmgr-status-failure";var E=I.status_success_class+"|"+I.status_failure_class;I.row_status_prefix="formmgr-has";var A=I.row_status_prefix+"([^\\s]+)";var J=new RegExp(C+A+G);I.status_marker_class="formmgr-message-text";I.Strings={submit_error:"Correct errors in the highlighted fields before continuing.",required_string:"This field requires a value.",required_menu:"This field is required. Choose a value from the pull-down list.",length_too_short:"Enter text that is at least {min} characters or longer.",length_too_long:"Enter text that is up to {max} characters long.",length_out_of_range:"Enter text that is {min} to {max} characters long.",integer:"Enter a whole number (no decimal point).",integer_too_small:"Enter a number that is {min} or higher (no decimal point).",integer_too_large:"Enter a number that is {max} or lower (no decimal point).",integer_out_of_range:"Enter a number between or including {min} and {max} (no decimal point).",decimal:"Enter a number.",decimal_too_small:"Enter a number that is {min} or higher.",decimal_too_large:"Enter a number that is {max} or lower.",decimal_out_of_range:"Enter a number between or including {min} and {max}."};I.status_order=["error","warn","success","info"];I.getStatusPrecedence=function(K){for(var L=0;L<I.status_order.length;L++){if(K==I.status_order[L]){return L;}}return I.status_order.length;};I.statusTakesPrecendence=function(L,K){return(!L||I.getStatusPrecedence(K)<I.getStatusPrecedence(L));};I.getElementStatus=function(L){var K=B.one(L).get("className").match(J);if(K&&K.length){return K[1];}else{return false;}};function D(K){if(B.Lang.isString(K)){return K.replace(/^#/,"");}else{if(K instanceof B.Node){return K.get("id");}else{return K.id;}}}function F(K){return(!B.Lang.isUndefined(K)&&K.length>0);}function H(){var O=(this.button_list.length===0);for(var N=0;N<this.form.elements.length;N++){var R=this.form.elements[N];var P=(R.type?R.type.toLowerCase():null);if(O&&(P=="submit"||P=="reset"||P=="button")){this.button_list.push(R);}if(!R.name){continue;}var M=R.tagName.toLowerCase();var K=this.default_value_map[R.name];if(M=="input"&&P=="file"){R.value="";}else{if(B.Lang.isUndefined(K)){if(M=="input"&&(P=="password"||P=="text")){this.default_value_map[R.name]=R.value;}else{if(M=="input"&&P=="checkbox"){this.default_value_map[R.name]=(R.checked?R.value:"");}else{if(M=="input"&&P=="radio"){var Q=this.form[R.name];if(Q&&!Q.length){this.default_value_map[R.name]=Q.value;}else{if(Q){this.default_value_map[R.name]=Q[0].value;for(var L=0;L<Q.length;L++){if(Q[L].checked){this.default_value_map[R.name]=Q[L].value;break;}}}}}else{if((M=="select"&&P=="select-one")||M=="textarea"){this.default_value_map[R.name]=R.value;}}}}}else{if(M=="input"&&(P=="password"||P=="text")){R.value=K;}else{if(M=="input"&&(P=="checkbox"||P=="radio")){R.checked=(R.value==K);}else{if(M=="select"&&P=="select-one"){R.value=K;if(R.selectedIndex>=0&&R.options[R.selectedIndex].value!==K){R.selectedIndex=-1;}}else{if(M=="textarea"){R.value=K;}}}}}}}}I.prototype={getForm:function(){if(!this.form){this.form=document.forms[this.form_name];}return this.form;},hasFileInputs:function(){return this.has_file_inputs;},setDefaultValues:function(K){this.default_value_map=K;},setDefaultValue:function(L,K){this.default_value_map[L]=K;},saveCurrentValuesAsDefault:function(){this.default_value_map={};this.button_list=[];H.call(this);},setFunction:function(L,K){this.validation.fn[D(L)]=K;},setRegex:function(M,L,K){M=D(M);if(B.Lang.isString(L)){this.validation.regex[M]=new RegExp(L,K);}else{this.validation.regex[M]=L;}if(!this.validation_msgs[M]||!this.validation_msgs[M].regex){}},setErrorMessage:function(L,K){this.validation_msgs[D(L)]=K;},addErrorMessage:function(M,K,L){M=D(M);if(!this.validation_msgs[M]){this.validation_msgs[M]={};}this.validation_msgs[M][K]=L;},clearForm:function(){this.clearMessages();this.form.reset();this.postPopulateForm();},populateForm:function(){if(!this.default_value_map){this.default_value_map={};}this.clearMessages();H.call(this);this.postPopulateForm();},postPopulateForm:function(){},isChanged:function(){for(var M=0;M<this.form.elements.length;M++){var P=this.form.elements[M];if(!P.name){continue;}var N=(P.type?P.type.toLowerCase():null);var L=P.tagName.toLowerCase();var K=this.default_value_map[P.name];if(K===null||typeof K==="undefined"){K="";}if(L=="input"&&N=="file"){if(P.value){return true;}}else{if(L=="input"&&(N=="password"||N=="text"||N=="file")){if(P.value!=K){return true;}}else{if(L=="input"&&(N=="checkbox"||N=="radio")){var O=(P.value==K);if((O&&!P.checked)||(!O&&P.checked)){return true;}}else{if((L=="select"&&N=="select-one")||L=="textarea"){if(P.value!=K){return true;}}}}}}return false;},prepareForm:function(){this.getForm();if(!this.prePrepareForm.apply(this,arguments)){return false;}this.clearMessages();this.populateForm();if(!this.postPrepareForm.apply(this,arguments)){return false;}return true;},prePrepareForm:function(){return true;},postPrepareForm:function(){return true;
},initFocus:function(){for(var M=0;M<this.form.elements.length;M++){var O=this.form.elements[M];if(O.disabled||O.offsetHeight===0){continue;}var K=O.tagName.toLowerCase();var N=(O.type?O.type.toLowerCase():null);if((K=="input"&&(N=="file"||N=="password"||N=="text"))||K=="textarea"){try{O.focus();}catch(L){}O.select();break;}}},validateForm:function(){this.clearMessages();var M=true;this.has_file_inputs=false;var Q=this.form.elements;for(var O=0;O<Q.length;O++){if(Q[O].type&&Q[O].type.toLowerCase()=="file"){this.has_file_inputs=true;}else{if(Q[O].type&&Q[O].type.toLowerCase()=="select-multiple"){}else{if(Q[O].value){Q[O].value=B.Lang.trim(Q[O].value);}}}}for(O=0;O<Q.length;O++){var N=Q[O].id;var S=this.validation_msgs[N];var R=B.one(Q[O]).hasClass(I.required_class);if(R&&Q[O].value===""){var K=null;if(S&&S.required){K=S.required;}else{if(Q[O].tagName.toLowerCase()=="select"){K=I.Strings.required_menu;}else{K=I.Strings.required_string;}}this.displayMessage(Q[O],K,"error");M=false;continue;}else{if(!R&&Q[O].value===""){continue;}}if(Q[O].className){var L=Q[O].className.match(I.length_class_re);if(L&&L.length){var K=null;var U=(F(L[1])&&L[1]!=="0");if(U&&F(L[2])){K=I.Strings.length_out_of_range;}else{if(U){K=I.Strings.length_too_short;}else{if(F(L[2])){K=I.Strings.length_too_long;}}}if(F(L[1])&&F(L[2])&&parseInt(L[1],10)>parseInt(L[2],10)){}if(Q[O].value&&F(L[1])&&Q[O].value.length<parseInt(L[1],10)){if(S&&S.min_length){K=S.min_length;}K=B.substitute(K,{min:parseInt(L[1],10),max:parseInt(L[2],10)});this.displayMessage(Q[O],K,"error");M=false;continue;}if(Q[O].value&&F(L[2])&&Q[O].value.length>parseInt(L[2],10)){if(S&&S.max_length){K=S.max_length;}K=B.substitute(K,{min:parseInt(L[1],10),max:parseInt(L[2],10)});this.displayMessage(Q[O],K,"error");M=false;continue;}}var L=Q[O].className.match(I.integer_class_re);if(L&&L.length){var K=null;if(S&&S.integer){K=S.integer;}else{if(F(L[1])&&F(L[2])){if(parseInt(L[1],10)>parseInt(L[2],10)){}K=I.Strings.integer_out_of_range;}else{if(F(L[1])){K=I.Strings.integer_too_small;}else{if(F(L[2])){K=I.Strings.integer_too_large;}else{K=I.Strings.integer;}}}}K=B.substitute(K,{min:parseInt(L[1],10),max:parseInt(L[2],10)});var T=parseInt(Q[O].value,10);if(Q[O].value&&(!I.integer_value_re.test(Q[O].value)||(F(L[1])&&T<parseInt(L[1],10))||(F(L[2])&&T>parseInt(L[2],10)))){this.displayMessage(Q[O],K,"error");M=false;continue;}}var L=Q[O].className.match(I.decimal_class_re);if(L&&L.length){var K=null;if(S&&S.decimal){K=S.decimal;}else{if(F(L[1])&&F(L[2])){if(parseFloat(L[1])>parseFloat(L[2])){}K=I.Strings.decimal_out_of_range;}else{if(F(L[1])){K=I.Strings.decimal_too_small;}else{if(F(L[2])){K=I.Strings.decimal_too_large;}else{K=I.Strings.decimal;}}}}K=B.substitute(K,{min:parseFloat(L[1],10),max:parseFloat(L[2],10)});var T=parseFloat(Q[O].value);if(Q[O].value&&(!I.decimal_value_re.test(Q[O].value)||(F(L[1])&&T<parseFloat(L[1]))||(F(L[2])&&T>parseFloat(L[2])))){this.displayMessage(Q[O],K,"error");M=false;continue;}}}if(this.validation.regex[N]&&!this.validation.regex[N].test(Q[O].value)){this.displayMessage(Q[O],S?S.regex:null,"error");M=false;continue;}var P=this.validation.fn[N];if(B.Lang.isFunction(P)){var V=this;}else{if(B.Lang.isString(P)){var V=this;P=V[P];}else{if(P&&P.scope){var V=P.scope;P=(B.Lang.isString(P.fn)?V[P.fn]:P.fn);}else{P=null;}}}if(P&&!P.call(V,this.form,B.one(Q[O]))){M=false;continue;}}if(!this.postValidateForm(this.form)){M=false;}if(!M){this.notifyErrors();}return M;},postValidateForm:function(K){return true;},registerButton:function(K){var L={e:B.one(K)};this.user_button_list.push(L);},enableForm:function(){this.setFormEnabled(true);},disableForm:function(){this.setFormEnabled(false);},setFormEnabled:function(K){this.enabled=K;var M=!K;for(var L=0;L<this.button_list.length;L++){this.button_list[L].disabled=M;}for(L=0;L<this.user_button_list.length;L++){var N=this.user_button_list[L];N.e.set("disabled",M);}},hasMessages:function(){return this.has_messages;},hasErrors:function(){return this.has_errors;},getRowStatus:function(L){var K=B.one(L).ancestor("."+I.row_marker_class);return I.getElementStatus(K);},clearMessages:function(){this.has_messages=false;this.has_errors=false;if(this.status_node){this.status_node.set("innerHTML","");this.status_node.replaceClass(E,I.status_none_class);}for(var K=0;K<this.form.elements.length;K++){var M=this.form.elements[K];var L=B.one(M).ancestor("."+I.row_marker_class);if(L&&L.hasClass(A)){L.all("."+I.status_marker_class).set("innerHTML","");L.removeClass(A);}}B.one(this.form).all("fieldset").removeClass(A);},displayMessage:function(P,Q,N,L){if(B.Lang.isUndefined(L)){L=true;}P=B.one(P);var O=P.ancestor("."+I.row_marker_class);if(O&&I.statusTakesPrecendence(I.getElementStatus(O),N)){if(Q){O.all("."+I.status_marker_class).set("innerHTML",Q);}O.removeClass(A);O.addClass(I.row_status_prefix+N);var K=P.ancestor("fieldset");if(K&&I.statusTakesPrecendence(I.getElementStatus(K),N)){K.removeClass(A);K.addClass(I.row_status_prefix+N);}if(!this.has_messages&&L&&P.get("offsetHeight")>0){O.scrollIntoView();try{P.focus();}catch(M){}}this.has_messages=true;if(N=="error"){this.has_errors=true;}}},notifyErrors:function(){this.displayFormMessage(I.Strings.submit_error,true,false);},displayFormMessage:function(M,L,K){if(B.Lang.isUndefined(K)){K=true;}if(this.status_node){if(!this.status_node.innerHTML){this.status_node.replaceClass(I.status_none_class,(L?I.status_failure_class:I.status_success_class));this.status_node.set("innerHTML",M);}if(K){this.status_node.scrollIntoView();}}else{}}};B.FormManager=I;},"@VERSION@",{requires:["node-base","substitute"]});