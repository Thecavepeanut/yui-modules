YUI.add("gallery-mathcanvas",function(b){function c(){this.list=[];}c.width=function(t){return t.right-t.left;};c.height=function(t){return t.bottom-t.top;};c.xcenter=function(t){return Math.floor((t.left+t.right)/2);};c.ycenter=function(t){return Math.floor((t.top+t.bottom)/2);};c.cover=function(u,t){var v={top:Math.min(u.top,t.top),left:Math.min(u.left,t.left),bottom:Math.max(u.bottom,t.bottom),right:Math.max(u.right,t.right)};return v;};c.prototype={add:function(w,u,t,v){this.list.push({rect:w,midline:u,font_size:t,func:v});return this.list.length-1;},get:function(t){return this.list[t];},find:function(t){return b.Array.find(this.list,function(u){return(u.func===t);});},shift:function(v,u,t){if(u===0&&t===0){return;}var w=this.list[v];var x=b.clone(w.rect);w.rect.top+=t;w.rect.left+=u;w.rect.bottom+=t;w.rect.right+=u;w.midline+=t;b.Array.each(this.list,function(y){if(x.left<=y.rect.left&&y.rect.right<=x.right&&x.top<=y.rect.top&&y.rect.bottom<=x.bottom){y.rect.top+=t;y.rect.left+=u;y.rect.bottom+=t;y.rect.right+=u;y.midline+=t;}});},setMidline:function(t,u){this.shift(t,0,u-this.list[t].midline);},getBounds:function(){return this.list[this.list.length-1].rect;}};function e(){}e.prototype={prepareToRender:function(w,v,u,t){var x=this.toString();var y={top:v.y,left:v.x,bottom:v.y+w.getLineHeight(u),right:v.x+w.getStringWidth(u,x)};return t.add(y,c.ycenter(y),u,this);},render:function(u,t){var v=t.find(this);u.drawString(v.rect.left,v.midline,v.font_size,this.toString());}};b.MathFunction=e;function i(t){i.superclass.constructor.call(this);this.value=parseInt(t);}b.extend(i,e,{evaluate:function(){return this.value;},toString:function(){return this.value;}});e.Value=i;function p(){p.superclass.constructor.call(this);}b.extend(p,e,{evaluate:function(){return Math.PI;},toString:function(){return"\u03c0";}});e.Pi=p;function a(){a.superclass.constructor.call(this);}b.extend(a,e,{evaluate:function(){return Math.E;},toString:function(){return"e";}});e.E=a;function l(u,t){l.superclass.constructor.call(this);this.name=u;if(b.Lang.isArray(t)&&b.Lang.isArray(t[0])){t=t[0];}if(b.Lang.isArray(t)){this.args=b.Array(t);}else{this.args=[];for(var v=1;v<arguments.length;v++){this.args.push(arguments[v]);}}}b.extend(l,e,{replaceArg:function(t,v){var u=b.Array.indexOf(this.args,t);if(u>=0){this.args[u]=v;}},evaluateArgs:function(){var t;b.Array.each(this.args,function(u){t.push(u.evaluate());});return t;},prepareToRender:function(u,F,y,G){var t={top:F.y,left:F.x,bottom:F.y+u.getLineHeight(y),right:F.x+u.getStringWidth(y,this.name)};var D=c.ycenter(t);var E=D;var v={x:t.right,y:t.top};var B=u.getStringWidth(y,", ");var I=this.args.length;var C=[];for(var A=0;A<I;A++){var z=this.args[A].prepareToRender(u,v,y,G);var x=G.get(z);var w=x.rect;v.x=w.right+B;t=c.cover(t,w);D=Math.max(D,x.midline);C.push(z);}if(I>1&&D>E){for(var A=0;A<I;A++){var z=C[A];G.setMidline(z,D);t=c.cover(t,G.get(z).rect);}}var H=u.getParenthesisWidth(t);for(var A=0;A<I;A++){G.shift(C[A],H,0);}t.right+=2*H;return G.add(t,D,y,this);},render:function(w,t){var y=t.find(this);w.drawString(y.rect.left,y.midline,y.font_size,this.name);var x={top:y.rect.top,bottom:y.rect.bottom};for(var v=0;v<this.args.length;v++){this.args[v].render(w,t);var y=t.find(this.args[v]);var u=y.rect;if(v===0){x.left=u.left;}if(v<this.args.length-1){w.drawString(u.right,y.midline,y.font_size,",");}else{x.right=u.right;w.drawParentheses(x);}}},toString:function(){return this.name+"("+this.args.join(",")+")";}});e.FunctionWithArgs=l;function o(){o.superclass.constructor.call(this,"min",new b.Array(arguments));}b.extend(o,l,{evaluate:function(){return Math.min.apply(null,this.evaluateArgs());}});e.Min=o;function s(){s.superclass.constructor.call(this,"max",new b.Array(arguments));}b.extend(s,l,{evaluate:function(){return Math.max.apply(null,this.evaluateArgs());}});e.Max=s;function f(t){f.superclass.constructor.call(this,"sqrt",t);}b.extend(f,l,{evaluate:function(){return Math.sqrt(this.args[0].evaluate());},prepareToRender:function(v,B,y,C){var D=this.args[0];var E=D.prepareToRender(v,B,y,C);var u=C.get(E);var A=c.height(u.rect);var x=1+Math.round(2*A/(4*Math.sqrt(3)));var z=3;var w=4;C.shift(E,x,w);var t={top:B.y,left:B.x,bottom:u.rect.bottom,right:u.rect.right+z};return C.add(t,u.midline,y,this);},render:function(u,t){var v=t.find(this);this._drawSquareRoot(u,v.rect);this.args[0].render(u,t);},_drawSquareRoot:function(v,A){var z=c.height(A);var t=A.left;var B=A.top+Math.round(3*z/4);var u=Math.round((z-3)/(4*Math.sqrt(3)));v.beginPath();v.moveTo(t,B);t+=u;B=A.bottom-1;v.lineTo(t,B);t+=u;B=A.top+2;v.lineTo(t,B);t=A.right-1;v.lineTo(t,B);v.line(0,Math.round(z/8));v.stroke();}});e.SquareRoot=f;function d(t){d.superclass.constructor.call(this,"sin",t);}b.extend(d,l,{evaluate:function(){return Math.sin(this.args[0].evaluate());}});e.Sine=d;function n(t){n.superclass.constructor.call(this,"cos",t);}b.extend(n,l,{evaluate:function(){return Math.cos(this.args[0].evaluate());}});e.Cosine=n;function g(t){g.superclass.constructor.call(this,"tan",t);}b.extend(g,l,{evaluate:function(){return Math.tan(this.args[0].evaluate());}});e.Tangent=g;var q=(function(){var y={trace:function v(){},yy:{},symbols_:{"error":2,"expressions":3,"e":4,"EOF":5,"NUMBER":6,"E":7,"PI":8,"(":9,")":10,"+":11,"-":12,"*":13,"/":14,"^":15,"SQRT":16,"SIN":17,"COS":18,"TAN":19,"MIN":20,"arglist":21,"MAX":22,",":23,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",6:"NUMBER",7:"E",8:"PI",9:"(",10:")",11:"+",12:"-",13:"*",14:"/",15:"^",16:"SQRT",17:"SIN",18:"COS",19:"TAN",20:"MIN",22:"MAX",23:","},productions_:[0,[3,2],[4,1],[4,1],[4,1],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,2],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[21,1],[21,3]],performAction:function u(z,C,D,G,F,B,E){var A=B.length-1;switch(F){case 1:return B[A-1];break;case 2:this.$=new G.MathFunction.Value(z);break;case 3:this.$=new G.MathFunction.E();break;case 4:this.$=new G.MathFunction.Pi();break;case 5:this.$=B[A-1];break;case 6:this.$=B[A-2]+B[A];break;case 7:this.$=B[A-2]-B[A];
break;case 8:this.$=B[A-2]*B[A];break;case 9:this.$=B[A-2]/B[A];break;case 10:this.$=Math.pow(B[A-2],B[A]);break;case 11:this.$=-B[A];break;case 12:this.$=new G.MathFunction.SquareRoot(B[A-1]);break;case 13:this.$=new G.MathFunction.Sine(B[A-1]);break;case 14:this.$=new G.MathFunction.Cosine(B[A-1]);break;case 15:this.$=new G.MathFunction.Tangent(B[A-1]);break;case 16:this.$=new G.MathFunction.Min(B[A-1]);break;case 17:this.$=new G.MathFunction.Max(B[A-1]);break;case 18:this.$=[B[A]];break;case 19:this.$=B[A-2].concat(B[A]);break;}},table:[{3:1,4:2,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{1:[3]},{5:[1,14],11:[1,15],12:[1,16],13:[1,17],14:[1,18],15:[1,19]},{5:[2,2],10:[2,2],11:[2,2],12:[2,2],13:[2,2],14:[2,2],15:[2,2],23:[2,2]},{5:[2,3],10:[2,3],11:[2,3],12:[2,3],13:[2,3],14:[2,3],15:[2,3],23:[2,3]},{5:[2,4],10:[2,4],11:[2,4],12:[2,4],13:[2,4],14:[2,4],15:[2,4],23:[2,4]},{4:20,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:21,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{9:[1,22]},{9:[1,23]},{9:[1,24]},{9:[1,25]},{9:[1,26]},{9:[1,27]},{1:[2,1]},{4:28,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:29,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:30,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:31,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:32,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{10:[1,33],11:[1,15],12:[1,16],13:[1,17],14:[1,18],15:[1,19]},{5:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],23:[2,11]},{4:34,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:35,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:36,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:37,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{4:39,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],21:38,22:[1,13]},{4:39,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],21:40,22:[1,13]},{5:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[1,17],14:[1,18],15:[1,19],23:[2,6]},{5:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[1,17],14:[1,18],15:[1,19],23:[2,7]},{5:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[1,19],23:[2,8]},{5:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[1,19],23:[2,9]},{5:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],23:[2,10]},{5:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],23:[2,5]},{10:[1,41],11:[1,15],12:[1,16],13:[1,17],14:[1,18],15:[1,19]},{10:[1,42],11:[1,15],12:[1,16],13:[1,17],14:[1,18],15:[1,19]},{10:[1,43],11:[1,15],12:[1,16],13:[1,17],14:[1,18],15:[1,19]},{10:[1,44],11:[1,15],12:[1,16],13:[1,17],14:[1,18],15:[1,19]},{10:[1,45],23:[1,46]},{10:[2,18],11:[1,15],12:[1,16],13:[1,17],14:[1,18],15:[1,19],23:[2,18]},{10:[1,47],23:[1,46]},{5:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],23:[2,12]},{5:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],23:[2,13]},{5:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],23:[2,14]},{5:[2,15],10:[2,15],11:[2,15],12:[2,15],13:[2,15],14:[2,15],15:[2,15],23:[2,15]},{5:[2,16],10:[2,16],11:[2,16],12:[2,16],13:[2,16],14:[2,16],15:[2,16],23:[2,16]},{4:48,6:[1,3],7:[1,4],8:[1,5],9:[1,6],12:[1,7],16:[1,8],17:[1,9],18:[1,10],19:[1,11],20:[1,12],22:[1,13]},{5:[2,17],10:[2,17],11:[2,17],12:[2,17],13:[2,17],14:[2,17],15:[2,17],23:[2,17]},{10:[2,19],11:[1,15],12:[1,16],13:[1,17],14:[1,18],15:[1,19],23:[2,19]}],defaultActions:{14:[2,1]},parseError:function w(A,z){throw new Error(A);},parse:function x(H){var O=this,E=[0],X=[null],J=[],Y=this.table,A="",I=0,V=0,C=0,G=2,L=1;this.lexer.setInput(H);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;var B=this.lexer.yylloc;J.push(B);if(typeof this.yy.parseError==="function"){this.parseError=this.yy.parseError;}function N(aa){E.length=E.length-2*aa;X.length=X.length-aa;J.length=J.length-aa;}function M(){var aa;aa=O.lexer.lex()||1;if(typeof aa!=="number"){aa=O.symbols_[aa]||aa;}return aa;}var U,Q,D,T,Z,K,S={},P,W,z,F;while(true){D=E[E.length-1];if(this.defaultActions[D]){T=this.defaultActions[D];}else{if(U==null){U=M();}T=Y[D]&&Y[D][U];}if(typeof T==="undefined"||!T.length||!T[0]){if(!C){F=[];for(P in Y[D]){if(this.terminals_[P]&&P>2){F.push("'"+this.terminals_[P]+"'");}}var R="";if(this.lexer.showPosition){R="Parse error on line "+(I+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+F.join(", ");}else{R="Parse error on line "+(I+1)+": Unexpected "+(U==1?"end of input":("'"+(this.terminals_[U]||U)+"'"));}this.parseError(R,{text:this.lexer.match,token:this.terminals_[U]||U,line:this.lexer.yylineno,loc:B,expected:F});}if(C==3){if(U==L){throw new Error(R||"Parsing halted.");}V=this.lexer.yyleng;A=this.lexer.yytext;I=this.lexer.yylineno;B=this.lexer.yylloc;U=M();}while(1){if((G.toString()) in Y[D]){break;}if(D==0){throw new Error(R||"Parsing halted.");}N(1);D=E[E.length-1];}Q=U;U=G;D=E[E.length-1];T=Y[D]&&Y[D][G];C=3;}if(T[0] instanceof Array&&T.length>1){throw new Error("Parse Error: multiple actions possible at state: "+D+", token: "+U);}switch(T[0]){case 1:E.push(U);X.push(this.lexer.yytext);J.push(this.lexer.yylloc);E.push(T[1]);U=null;if(!Q){V=this.lexer.yyleng;A=this.lexer.yytext;I=this.lexer.yylineno;B=this.lexer.yylloc;if(C>0){C--;}}else{U=Q;Q=null;}break;case 2:W=this.productions_[T[1]][1];S.$=X[X.length-W];S._$={first_line:J[J.length-(W||1)].first_line,last_line:J[J.length-1].last_line,first_column:J[J.length-(W||1)].first_column,last_column:J[J.length-1].last_column,};
K=this.performAction.call(S,A,V,I,this.yy,T[1],X,J);if(typeof K!=="undefined"){return K;}if(W){E=E.slice(0,-1*W*2);X=X.slice(0,-1*W);J=J.slice(0,-1*W);}E.push(this.productions_[T[1]][0]);X.push(S.$);J.push(S._$);z=Y[E[E.length-2]][E[E.length-1]];E.push(z);break;case 3:return true;}}return true;}};var t=(function(){var C=({EOF:1,parseError:function E(H,G){if(this.yy.parseError){this.yy.parseError(H,G);}else{throw new Error(H);}},setInput:function(G){this._input=G;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this;},input:function(){var H=this._input[0];this.yytext+=H;this.yyleng++;this.match+=H;this.matched+=H;var G=H.match(/\n/);if(G){this.yylineno++;}this._input=this._input.slice(1);return H;},unput:function(G){this._input=G+this._input;return this;},more:function(){this._more=true;return this;},pastInput:function(){var G=this.matched.substr(0,this.matched.length-this.match.length);return(G.length>20?"...":"")+G.substr(-20).replace(/\n/g,"");},upcomingInput:function(){var G=this.match;if(G.length<20){G+=this._input.substr(0,20-G.length);}return(G.substr(0,20)+(G.length>20?"...":"")).replace(/\n/g,"");},showPosition:function(){var G=this.pastInput();var H=new Array(G.length+1).join("-");return G+this.upcomingInput()+"\n"+H+"^";},next:function(){if(this.done){return this.EOF;}if(!this._input){this.done=true;}var K,I,H,G;if(!this._more){this.yytext="";this.match="";}var L=this._currentRules();for(var J=0;J<L.length;J++){I=this._input.match(this.rules[L[J]]);if(I){G=I[0].match(/\n.*/g);if(G){this.yylineno+=G.length;}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:G?G[G.length-1].length-1:this.yylloc.last_column+I.length};this.yytext+=I[0];this.match+=I[0];this.matches=I;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(I[0].length);this.matched+=I[0];K=this.performAction.call(this,this.yy,this,L[J],this.conditionStack[this.conditionStack.length-1]);if(K){return K;}else{return;}}}if(this._input===""){return this.EOF;}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});}},lex:function z(){var G=this.next();if(typeof G!=="undefined"){return G;}else{return this.lex();}},begin:function A(G){this.conditionStack.push(G);},popState:function F(){return this.conditionStack.pop();},_currentRules:function D(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules;}});C.performAction=function B(K,H,J,G){var I=G;switch(J){case 0:break;case 1:return 6;break;case 2:return 13;break;case 3:return 14;break;case 4:return 12;break;case 5:return 11;break;case 6:return 15;break;case 7:return 9;break;case 8:return 10;break;case 9:return 8;break;case 10:return 7;break;case 11:return 23;break;case 12:return 22;break;case 13:return 20;break;case 14:return 17;break;case 15:return 18;break;case 16:return 19;break;case 17:return 16;break;case 18:return 5;break;}};C.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b\b/,/^\*/,/^\//,/^-/,/^\+/,/^\^/,/^\(/,/^\)/,/^pi\b/,/^e\b/,/^,/,/^max\b/,/^min\b/,/^sin\b/,/^cos\b/,/^tan\b/,/^sqrt\b/,/^$/];C.conditions={"INITIAL":{"rules":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],"inclusive":true}};return C;})();y.lexer=t;return y;})();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=q;exports.parse=function(){return q.parse.apply(q,arguments);};exports.main=function h(t){if(!t[1]){throw new Error("Usage: "+t[0]+" FILE");}if(typeof process!=="undefined"){var v=require("fs").readFileSync(require("path").join(process.cwd(),t[1]),"utf8");}else{var u=require("file").path(require("file").cwd());var v=u.join(t[1]).read({charset:"utf-8"});}return exports.parser.parse(v);};if(typeof module!=="undefined"&&require.main===module){exports.main(typeof process!=="undefined"?process.argv.slice(1):require("system").args);}}function r(t){r.superclass.constructor.call(this,t);}r.NAME="MathCanvas";r.ATTRS={func:{value:new b.MathFunction.Value(0),setter:function(t){return b.Lang.isString(t)?b.MathCanvas.Parser.parse(t):t;}},fontname:{value:"sans-serif",validator:b.Lang.isString},fontsize:{value:1,validator:b.Lang.isNumber},minwidth:{value:100,validator:b.Lang.isNumber},minheight:{value:100,validator:b.Lang.isNumber}};function m(t,u){if(t&&t.newVal){t=t.newVal;}else{if(!t){t=this.get("min"+u);}}t=Math.max(t,this["render_"+u]+5);this.set(u,t+"px");this.canvas.setAttribute(u,t);}b.extend(r,b.Widget,{initializer:function(t){this.after("funcChange",this._renderExpression);},renderUI:function(){var u=this.get("contentBox");this.on("minwidthChange",m,this,"width");this.on("minheightChange",m,this,"height");var t=this.get("minwidth");this.set("width",t+"px");var v=this.get("minheight");this.set("height",t+"px");this.canvas=b.Node.create('<canvas width="'+t+'" height="'+v+'" tabindex="0"></canvas>');u.appendChild(this.canvas);this.context=new b.Canvas.Context2d(this.canvas);b.mix(this.context,j);this.context.math_canvas=this;this._renderExpression();},destructor:function(){this.canvas=null;this.context=null;},_renderExpression:function(){this.context.clearRect(0,0,this.canvas.getAttribute("width"),this.canvas.getAttribute("height"));var v=this.get("func");if(!v){return;}this.rect_list=new c();var t={x:0,y:0};v.prepareToRender(this.context,t,100,this.rect_list);var u=this.rect_list.getBounds();this.render_width=c.width(u);m.call(this,null,"width");this.render_height=c.height(u);m.call(this,null,"height");this.context.save();this.context.translate(Math.floor((this.canvas.getAttribute("width")-(u.right-u.left))/2),Math.floor((this.canvas.getAttribute("height")-(u.bottom-u.top))/2));v.render(this.context,this.rect_list);this.context.restore();}});var k=Math.PI/6;var j={drawString:function(x,u,t,w){var v=this.getLineHeight(t);
this._setFont(t);this.set("textBaseline","top");this.fillText(w,x,Math.floor(u-v/2));},getLineHeight:function(t){return(13*this.math_canvas.get("fontsize")*t/100);},getStringWidth:function(t,v){this.save();this._setFont(t);var u=this.measureText(v).width;this.restore();return u;},_setFont:function(t){this.set("font",(this.math_canvas.get("fontsize")*t/100)+"em "+this.math_canvas.get("fontname"));},drawSquareBrackets:function(v){var u=v.bottom-v.top;var t=this.getSquareBracketWidth(v)-2;this.moveTo(v.left-2,v.top);this.line(-t,0);this.line(0,u-1);this.line(t,0);this.stroke();this.moveTo(v.right+1,v.top);this.line(t,0);this.line(0,u-1);this.line(-t,0);this.stroke();},getSquareBracketWidth:function(u){var t=u.bottom-u.top;return Math.round(3+((t-1)/10));},drawParentheses:function(x){var w=x.bottom-x.top;var t=w/(2*Math.sin(k));var u=Math.round(t);var y=c.ycenter(x);var v=this.getParenthesisWidth(x);this.beginPath();this.arc(x.left-v+t,y,u,Math.PI-k,Math.PI+k,false);this.stroke();this.beginPath();this.arc(x.right+v-t,y,u,k,-k,true);this.stroke();},getParenthesisWidth:function(u){var t=u.bottom-u.top;return 2+Math.round(0.5+(t*(1-Math.cos(k)))/(2*Math.sin(k)));}};q.yy.MathFunction=b.MathFunction;b.MathCanvas=r;b.MathCanvas.RectList=c;b.MathCanvas.Parser=q;},"@VERSION@",{requires:["widget","collection","gallery-complexnumber","gallery-canvas"]});