YUI.add("gallery-io-multiresponse",function(e,t){function u(t,n,r){var i=e.Node.create('<iframe id="io-multi-response-'+t.id+'" name="io-multi-response-'+t.id+'" />');i._node.style.position="absolute",i._node.style.top="-1000px",i._node.style.left="-1000px",e.one("body").appendChild(i),e.on("load",function(){r._multi_complete(t,n)},"#io-multi-response-"+t.id)}function a(t){var n=e.guid("io-multi-response-form-"),r=e.Node.create('<form id="'+n+'" name="'+n+'" />');return r._node.style.position="absolute",r._node.style.top="-1000px",r._node.style.left="-1000px",e.one("body").appendChild(r),n}var n=e.Lang,r=e.config.win,i=e.config.doc,s=i.documentMode&&i.documentMode>=8,o=decodeURIComponent;e.mix(e.IO.prototype,{_addJSON:function(t,n){e.Lang.isString(n)||(n=e.JSON.stringify(n));var r=i.createElement("input");return r.type="hidden",r.name="json",r.value=n,t.appendChild(r),r},_multi_setAttrs:function(t,n,r,i){t.setAttribute("action",r),t.setAttribute("method",i||"POST"),t.setAttribute("target","io-multi-response-"+n),t.setAttribute(e.UA.ie&&!s?"encoding":"enctype","multipart/form-data")},_multi_startTimeout:function(e,t){var n=this;n._timeout[e.id]=r.setTimeout(function(){e.status=0,e.statusText="timeout",n.end(e,t)},t.timeout)},_multi_destroy:function(t,n){n.debug||(e.Event.purgeElement("#io-multi-response-"+t,!1),e.one("body").removeChild(e.one("#io-multi-response-"+t))),n.form.id.indexOf("io-multi-response-form-")===0&&e.one("body").removeChild(e.one("#"+n.form.id))},_multi_complete:function(e,t){var n=this;t.timeout&&n._clearTimeout(e.id),n.end(e,t),r.setTimeout(function(){n._multi_destroy(e.id,t)},0)},_multi_send:function(t,n,r){var s=this,o=typeof r.form.id=="string"?i.getElementById(r.form.id):r.form.id,u={method:o.getAttribute("method"),action:o.getAttribute("action"),target:o.getAttribute("target")},a=[];return s._multi_setAttrs(o,t.id,n,r.method),r.data&&(a=s._addData(o,r.data)),r.json&&a.push(s._addJSON(o,r.json)),r.timeout&&s._multi_startTimeout(t,r),o.submit(),s.start(t,r),r.data&&s._removeData(o,a),s._resetAttrs(o,u),{id:t.id,abort:function(){t.status=0,t.statusText="abort";if(!e.one("#io-multi-response-"+t.id))return!1;s._multi_destroy(t.id,r),s.end(t,r)},isInProgress:function(){return e.one("#io-multi-response-"+t.id)?!0:!1},io:s}}});var f=e.IO.prototype._init;e.IO.prototype._init=function(t){f.apply(this,arguments),this.publish("io:response",e.merge({broadcast:1},t)),this.publish("io-trn:response",t)};var l=e.IO.prototype.upload;e.IO.prototype.upload=function(t,r,i){if(!i.multiresponse)return l.apply(this,arguments);var s=this;YUI.Env.io_multi_response_callback[t.id]=function(n){if(!n){e.error("Callback "+t.id+" invoked without data.",null,"io");return}i.timeout&&(s._clearTimeout(t.id),s._multi_startTimeout(t,i)),i.on&&i.on.response&&(t.c=n,s._evt("response",t,i))};var o=encodeURIComponent("window.parent.YUI.Env.io_multi_response_callback["+t.id+"]"),a="callback="+o;return i.data?n.isObject(i.data)?i.data.callback=o:i.data=i.data+"&"+a:i.data=a,i.form&&!i.form.id&&delete i.form,u(t,i,s),s._multi_send(t,r,i)},YUI.Env.io_multi_response_callback||(YUI.Env.io_multi_response_callback=[]);var c=e.io;e.io=function(e,t){return t.multiresponse&&!t.form?t.form={id:a(t),upload:!0}:t.multiresponse&&!t.form.upload&&(t.form.upload=!0),c.call(this,e,t)},e.mix(e.io,c)},"@VERSION@",{requires:["io-upload-iframe"],optional:["json-stringify"]});
