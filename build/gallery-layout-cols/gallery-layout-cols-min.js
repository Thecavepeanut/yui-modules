YUI.add("gallery-layout-cols",function(e,t){"use strict";function r(t,n){var r=t;return n.hd&&(r-=n.hd.get("offsetHeight")),n.ft&&(r-=n.ft.get("offsetHeight")),r-=n.bd.vertMarginBorderPadding(),Math.max(r,e.PageLayout.min_module_height)}function i(e,t,n,r,i,s){return s.mbp=i.vertMarginBorderPadding(),Math.max(1,Math.floor(e*t[n][r]/100)-s.mbp)}var n=0<e.UA.ie&&e.UA.ie<8;e.namespace("PageLayoutCols"),e.PageLayoutCols.collapse_classes={vert_parent_class:e.PageLayout.module_class,horiz_parent_class:e.PageLayout.module_cols_class,collapse_parent_pattern:"("+e.PageLayout.expand_left_nub_class+"|"+e.PageLayout.expand_right_nub_class+")"},e.PageLayoutCols.resize=function(t,s,o,u){var a=t.get("matchColumnHeights"),f=t.body_info.outers.size();if(s===e.PageLayout.FIT_TO_VIEWPORT){var l=[],c=[];for(var h=0;h<f;h++){var p=t.body_info.inner_sizes[h].slice(0);l.push(p),c.push(u);var d=0,v=0,m=t.body_info.modules[h],g=m.size();for(var y=0;y<g;y++){var b=m.item(y);b.hasClass(e.PageLayout.collapsed_vert_class)?(b.setStyle("height","auto"),p[y]=-b.get("offsetHeight"),c[h]-=b.totalHeight()):p[y]>0&&(d++,v+=p[y])}if(d<g)for(var y=0;y<g;y++)p[y]>0&&(p[y]*=100/v)}}var w={},E=t.body_info.outer_sizes.slice(0),d=0,v=0;for(var h=0;h<f;h++){var S=t.body_info.outers.item(h),x=S.hasClass(e.PageLayout.collapsed_horiz_class),m=t.body_info.modules[h];if(x||E[h]<0){E[h]=0;if(x)S.setStyle("width","auto"),m.item(0).setStyle("width","auto");else if(n){var T=t._analyzeModule(m.item(0));if(T.bd){var N=T.bd.totalWidth()+m.item(y).horizMarginBorderPadding();T.root.setStyle("width",N+"px"),S.setStyle("width",N+"px")}}o-=S.totalWidth()}else d++,v+=E[h],m.size()==1&&m.item(0).setStyle("height","auto")}if(d<f)for(var h=0;h<f;h++)E[h]*=100/v;var C=0,k=0,L=[];for(var h=0;h<f;h++){if(E[h]==0){var b=t.body_info.modules[h].item(0),T=t._analyzeModule(b);if(s===e.PageLayout.FIT_TO_VIEWPORT){var A=i(c[h],l,h,0,b,w);b.setStyle("height",A+"px");if(T.bd){var O=r(A,T),M=T.bd.insideWidth();t.fire("beforeResizeModule",{bd:T.bd,height:O,width:M}),T.bd.setStyle("height",O+"px"),t.fire("afterResizeModule",{bd:T.bd,height:O,width:M})}}else T.bd&&(t.fire("beforeResizeModule",{bd:T.bd,height:"auto",width:"auto"}),T.root.setStyle("height","auto"),T.bd.setStyle("height","auto"),a?L.push([[T.bd,T.bd.insideWidth()]]):t.fire("afterResizeModule",{bd:T.bd,height:T.bd.insideHeight(),width:T.bd.insideWidth()}));continue}k++;var _=Math.max(1,Math.floor(o*E[h]/100));C+=_,k==d&&(_+=o-C),_=Math.max(1,_-t.body_info.outers.item(h).horizMarginBorderPadding()),t.body_info.outers.item(h).setStyle("width",_+"px"),_=Math.max(1,_-t.body_info.modules[0].item(0).horizMarginBorderPadding());var m=t.body_info.modules[h];if(s===e.PageLayout.FIT_TO_VIEWPORT){var D=0,P=m.size(),g=P;for(var y=0;y<g;y++){var A=l[h][y];A<0&&(D+=m.item(y).totalHeight(),P--)}var H=0;for(var y=0;y<g;y++){var b=m.item(y),T=t._analyzeModule(b);if(l[h][y]<0){var O=T.bd.insideHeight(),M=_-T.root.horizMarginBorderPadding()-T.bd.horizMarginBorderPadding();t.fire("beforeResizeModule",{bd:T.bd,height:O,width:M}),b.setStyle("width",_+"px"),t.fire("afterResizeModule",{bd:T.bd,height:O,width:M});continue}H++;if(T.bd){var A=i(c[h],l,h,y,b,w),O=r(A,T);D+=A+w.mbp,H==P&&(O+=u-D);var M=Math.max(1,_-T.bd.horizMarginBorderPadding());t.fire("beforeResizeModule",{bd:T.bd,height:O,width:M}),t._setWidth(T,_),T.bd.setStyle("height",O+"px"),t.fire("afterResizeModule",{bd:T.bd,height:O,width:M})}}}else{L.push([]);var g=m.size();for(var y=0;y<g;y++){var T=t._analyzeModule(m.item(y));if(T.bd){var M=Math.max(1,_-T.bd.horizMarginBorderPadding());t.fire("beforeResizeModule",{bd:T.bd,height:"auto",width:M}),t._setWidth(T,_),T.root.setStyle("height","auto"),T.bd.setStyle("height","auto"),a?L[h].push([T.bd,M]):t.fire("afterResizeModule",{bd:T.bd,height:T.bd.insideHeight(),width:M})}}}}if(s===e.PageLayout.FIT_TO_CONTENT&&a){var A=0;for(var h=0;h<f;h++)A=Math.max(A,t.body_info.outers.item(h).get("offsetHeight"));for(var h=0;h<f;h++){var m=t.body_info.modules[h],g=m.size(),b=null,M=0;for(var y=g-1;y>=0;y--){var B=m.item(y);if(g==1||!b&&!B.hasClass(e.PageLayout.collapsed_vert_class)&&t.body_info.inner_sizes[h][y]>0)b=B,M=L[h][y][1];else{var j=L[h][y][0];t.fire("afterResizeModule",{bd:j,height:j.insideHeight(),width:L[h][y][1]})}}if(b){var F=A-t.body_info.outers.item(h).get("offsetHeight");if(F>0&&b.get("parentNode").hasClass(e.PageLayout.collapsed_horiz_class))b.setStyle("height",b.insideHeight()+F+"px");else{var T=t._analyzeModule(b);if(T.bd){var O=T.bd.insideHeight()+F;b.setStyle("height","auto"),T.bd.setStyle("height",O+"px"),t.fire("afterResizeModule",{bd:T.bd,height:O,width:M})}}}}}}},"@VERSION@",{requires:["gallery-layout"]});
