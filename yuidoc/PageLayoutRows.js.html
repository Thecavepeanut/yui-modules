<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns:yui="http://yuilibrary.com/rdf/1.0/yui.rdf#">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<title>API: gallery-layout   PageLayoutRows.js  (YUI Library)</title>

	<link rel="stylesheet" type="text/css" href="assets/reset-fonts-grids-min.css" />
	<link rel="stylesheet" type="text/css" href="assets/api.css" />

    <script type="text/javascript" src="assets/api-js"></script>
    <script type="text/javascript" src="assets/ac-js"></script>
</head>

<body id="yahoo-com">

<div id="doc3" class="yui-t2">
	<div id="hd">
        <h1><a href="http://developer.yahoo.com/yui/" title="Yahoo! UI Library">Yahoo! UI Library</a></h1>
        <h3>gallery-layout&nbsp; <span class="subtitle">1.0.0</span></h3>
        <a href="./index.html" title="Yahoo! UI Library">Yahoo! UI Library</a> 
            &gt; <a href="./module_gallery-layout.html" title="gallery-layout">gallery-layout</a>
                
                 &gt; PageLayoutRows.js (source view) 
        <form onsubmit="return false">
            <div id="propertysearch">
                Search: <input autocomplete="off" id="searchinput" />
                <div id="searchresults">
                    &nbsp;
                </div>
            </div>
        </form>
	</div>

	<div id="bd">
		<div id="yui-main">
			<div class="yui-b">
            <form action="#" name="yui-classopts-form" method="get" id="yui-classopts-form">
                <fieldset>
                    <legend>Filters</legend>
                <span class="classopts"><input type="checkbox" name="show_private" id="show_private" /> <label for="show_private">Show Private</label></span>
                <span class="classopts"><input type="checkbox" name="show_protected" id="show_protected" /> <label for="show_protected">Show Protected</label></span>
                <span class="classopts"><input type="checkbox" name="show_deprecated" id="show_deprecated" /> <label for="show_deprecated">Show Deprecated</label></span>
                </fieldset>
            </form>

                    <div id="srcout">
                        <style>
                            #doc3 .classopts { display:none; }
                        </style>
                        <div class="highlight"><pre><span class="s2">&quot;use strict&quot;</span><span class="o">;</span>

<span class="kd">var</span> <span class="nx">has_no_recalc_auto_bug</span>    <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span><span class="o">,</span>
	<span class="nx">has_explosive_modules_bug</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span><span class="o">,</span>
	<span class="nx">is_borked_dom_access</span>      <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&amp;&amp;</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">UA</span><span class="p">.</span><span class="nx">ie</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">);</span>

<span class="c">/**</span>
<span class="c"> * PageLayout plugin for managing vertically stacked rows on a page,</span>
<span class="c"> * sandwiched vertically between header and footer.  Each row contains one</span>
<span class="c"> * or more modules.</span>
<span class="c"> * </span>
<span class="c"> * @module gallery-layout</span>
<span class="c"> * @submodule gallery-layout-rows</span>
<span class="c"> */</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">namespace</span><span class="p">(</span><span class="s1">&#39;PageLayoutRows&#39;</span><span class="p">);</span>

<span class="c">// must be done after defining Y.PageLayoutRows</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayoutRows</span><span class="p">.</span><span class="nx">collapse_classes</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="nx">vert_parent_class</span><span class="o">:</span>       <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">module_rows_class</span><span class="o">,</span>
	<span class="nx">horiz_parent_class</span><span class="o">:</span>      <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">module_class</span><span class="o">,</span>
	<span class="nx">collapse_parent_pattern</span><span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">expand_vert_nub_class</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">adjustHeight</span><span class="p">(</span>
	<span class="c">/* int */</span>		<span class="nx">total_height</span><span class="o">,</span>
	<span class="c">/* object */</span>	<span class="nx">children</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">total_height</span><span class="o">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">is_borked_dom_access</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kd">var</span> <span class="nx">access_dom_so_it_will_be_right_next_time</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">hd</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nx">h</span> <span class="o">-=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">hd</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">);</span>
		<span class="nx">b</span> <span class="o">-=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">hd</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">ft</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nx">h</span> <span class="o">-=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">ft</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">);</span>
		<span class="nx">b</span> <span class="o">-=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">ft</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="nx">h</span> <span class="o">-=</span> <span class="nx">b</span><span class="o">;</span>

	<span class="nx">h</span> <span class="o">-=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">vertMarginBorderPadding</span><span class="p">();</span>

	<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">h</span><span class="o">,</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">min_module_height</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getWidth</span><span class="p">(</span>
	<span class="c">/* int */</span>		<span class="nx">body_width</span><span class="o">,</span>
	<span class="c">/* array */</span>		<span class="nx">col_widths</span><span class="o">,</span>
	<span class="c">/* int */</span>		<span class="nx">row_index</span><span class="o">,</span>
	<span class="c">/* int */</span>		<span class="nx">col_index</span><span class="o">,</span>
	<span class="c">/* object */</span>	<span class="nx">module</span><span class="o">,</span>
	<span class="c">/* object */</span>	<span class="nx">module_info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="nx">module_info</span><span class="p">.</span><span class="nx">mbp</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">horizMarginBorderPadding</span><span class="p">();</span>
	<span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">body_width</span> <span class="o">*</span> <span class="nx">col_widths</span><span class="p">[</span> <span class="nx">row_index</span> <span class="p">][</span> <span class="nx">col_index</span> <span class="p">]</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span> <span class="o">-</span> <span class="nx">module_info</span><span class="p">.</span><span class="nx">mbp</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayoutRows</span><span class="p">.</span><span class="nx">resize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span>
	<span class="c">/* PageLayout */</span>	<span class="nx">host</span><span class="o">,</span>
	<span class="c">/* enum */</span>			<span class="nx">mode</span><span class="o">,</span>
	<span class="c">/* int */</span>			<span class="nx">body_width</span><span class="o">,</span>
	<span class="c">/* int */</span>			<span class="nx">body_height</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kd">var</span> <span class="nx">row_count</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">outers</span><span class="p">.</span><span class="nx">size</span><span class="p">();</span>

	<span class="c">// reset module heights</span>
	<span class="c">// adjust for horizontally collapsed or fixed width modules</span>

	<span class="kd">var</span> <span class="nx">col_widths</span> <span class="o">=</span> <span class="p">[]</span><span class="o">,</span>
		<span class="nx">row_widths</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">row_count</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kd">var</span> <span class="nx">widths</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">inner_sizes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="nx">col_widths</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">widths</span><span class="p">);</span>
		<span class="nx">row_widths</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">body_width</span><span class="p">);</span>

		<span class="kd">var</span> <span class="nx">uncollapsed_count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">sum</span>               <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

		<span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
		<span class="kd">var</span> <span class="nx">count</span>   <span class="o">=</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">size</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">count</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span>
			<span class="nx">module</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">module</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">collapsed_horiz_class</span><span class="p">))</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">has_no_recalc_auto_bug</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="nx">module</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="o">,</span> <span class="s1">&#39;none&#39;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">module</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">has_no_recalc_auto_bug</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="nx">module</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="o">,</span> <span class="s1">&#39;block&#39;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">widths</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span>      <span class="o">=</span> <span class="o">-</span> <span class="nx">module</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetWidth&#39;</span><span class="p">);</span>
				<span class="nx">row_widths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">totalWidth</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">widths</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="nx">uncollapsed_count</span><span class="o">++;</span>
				<span class="nx">sum</span> <span class="o">+=</span> <span class="nx">widths</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">uncollapsed_count</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">count</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">widths</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="nx">widths</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">/</span> <span class="nx">sum</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c">// smart fit:  if only one module, fit-to-content until it won&#39;t fit inside viewport</span>

	<span class="kd">var</span> <span class="nx">module_info</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="k">if</span> <span class="p">(</span><span class="nx">host</span><span class="p">.</span><span class="nx">single_module</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kd">var</span> <span class="nx">module</span>   <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">_analyzeModule</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kd">var</span> <span class="nx">w</span>  <span class="o">=</span> <span class="nx">getWidth</span><span class="p">(</span><span class="nx">row_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">,</span> <span class="nx">col_widths</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">module</span><span class="o">,</span> <span class="nx">module_info</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">horizMarginBorderPadding</span><span class="p">());</span>
			<span class="nx">host</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;beforeResizeModule&#39;</span><span class="o">,</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="o">,</span> <span class="nx">w1</span><span class="p">);</span>
			<span class="nx">host</span><span class="p">.</span><span class="nx">_setWidth</span><span class="p">(</span><span class="nx">children</span><span class="o">,</span> <span class="nx">w</span><span class="p">);</span>
			<span class="nx">children</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
			<span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">totalHeight</span><span class="p">();</span>
		<span class="nx">mode</span>  <span class="o">=</span> <span class="p">(</span><span class="nx">h</span> <span class="o">&gt;</span> <span class="nx">body_height</span> <span class="o">?</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">FIT_TO_VIEWPORT</span> <span class="o">:</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">FIT_TO_CONTENT</span><span class="p">);</span>

		<span class="nx">host</span><span class="p">.</span><span class="nx">body_container</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;FIT_TO_[A-Z_]+&#39;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c">// fit-to-content:  compute height of each row; requires setting module widths</span>
	<span class="c">// fit-to-viewport: adjust for vertically collapsed modules</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">FIT_TO_CONTENT</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kd">var</span> <span class="nx">row_heights</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">row_count</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">outers</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>

			<span class="kd">var</span> <span class="nx">modules</span>    <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
			<span class="kd">var</span> <span class="nx">h</span>          <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
			<span class="kd">var</span> <span class="nx">total_w</span>    <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
			<span class="kd">var</span> <span class="nx">open_count</span> <span class="o">=</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">size</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">count</span>      <span class="o">=</span> <span class="nx">open_count</span><span class="o">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">count</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="kd">var</span> <span class="nx">w</span>      <span class="o">=</span> <span class="nx">col_widths</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">];</span>
				<span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kd">var</span> <span class="nx">total_w_hacked</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">w</span> <span class="o">==</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">unmanaged_size</span> <span class="o">&amp;&amp;</span> <span class="nx">has_explosive_modules_bug</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">_analyzeModule</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
						<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">)</span>
						<span class="p">{</span>
							<span class="kd">var</span> <span class="nx">bd_w</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">totalWidth</span><span class="p">();</span>
							<span class="nx">total_w</span> <span class="o">+=</span> <span class="nx">bd_w</span> <span class="o">+</span> <span class="nx">module</span><span class="p">.</span><span class="nx">horizMarginBorderPadding</span><span class="p">();</span>
							<span class="nx">total_w_hacked</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

							<span class="nx">children</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="o">,</span> <span class="nx">bd_w</span><span class="o">+</span><span class="s1">&#39;px&#39;</span><span class="p">);</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">total_w_hacked</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="nx">total_w</span> <span class="o">+=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">totalWidth</span><span class="p">();</span>
					<span class="p">}</span>
					<span class="nx">open_count</span><span class="o">--;</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">count</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="kd">var</span> <span class="nx">w</span>      <span class="o">=</span> <span class="nx">col_widths</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">];</span>
				<span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">w</span> <span class="o">==</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">unmanaged_size</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">_analyzeModule</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
						<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">)</span>
						<span class="p">{</span>
							<span class="nx">children</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
							<span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
						<span class="p">}</span>

						<span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">h</span><span class="o">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">));</span>
					<span class="p">}</span>
					<span class="k">continue</span><span class="o">;</span>
				<span class="p">}</span>
				<span class="nx">k</span><span class="o">++;</span>

				<span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">_analyzeModule</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kd">var</span> <span class="nx">w</span>    <span class="o">=</span> <span class="nx">getWidth</span><span class="p">(</span><span class="nx">row_widths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">col_widths</span><span class="o">,</span> <span class="nx">i</span><span class="o">,</span> <span class="nx">j</span><span class="o">,</span> <span class="nx">module</span><span class="o">,</span> <span class="nx">module_info</span><span class="p">);</span>
					<span class="nx">total_w</span> <span class="o">+=</span> <span class="nx">w</span> <span class="o">+</span> <span class="nx">module_info</span><span class="p">.</span><span class="nx">mbp</span><span class="o">;</span>

					<span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">==</span> <span class="nx">open_count</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="nx">w</span> <span class="o">+=</span> <span class="nx">body_width</span> <span class="o">-</span> <span class="nx">total_w</span><span class="o">;</span>
					<span class="p">}</span>

					<span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">horizMarginBorderPadding</span><span class="p">());</span>
					<span class="nx">host</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;beforeResizeModule&#39;</span><span class="o">,</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="o">,</span> <span class="nx">w1</span><span class="p">);</span>
					<span class="nx">host</span><span class="p">.</span><span class="nx">_setWidth</span><span class="p">(</span><span class="nx">children</span><span class="o">,</span> <span class="nx">w</span><span class="p">);</span>
					<span class="nx">children</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
					<span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
				<span class="p">}</span>

				<span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">h</span><span class="o">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offsetHeight&#39;</span><span class="p">));</span>
			<span class="p">}</span>

			<span class="nx">row_heights</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">h</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="kd">var</span> <span class="nx">row_heights</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">outer_sizes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

		<span class="kd">var</span> <span class="nx">uncollapsed_count</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span>
			<span class="nx">sum</span>               <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">row_count</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kd">var</span> <span class="nx">row</span>       <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">outers</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">collapsed</span> <span class="o">=</span> <span class="nx">row</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">collapsed_vert_class</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">collapsed</span> <span class="o">||</span> <span class="nx">row_heights</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="nx">row_heights</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">collapsed</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="nx">row</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
				<span class="p">}</span>

				<span class="c">// We cannot compute the height of row directly</span>
				<span class="c">// because the row above might be wrapping.</span>

				<span class="nx">body_height</span> <span class="o">-=</span> <span class="nx">row</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">).</span><span class="nx">totalHeight</span><span class="p">();</span>
				<span class="nx">body_height</span> <span class="o">-=</span> <span class="nx">row</span><span class="p">.</span><span class="nx">vertMarginBorderPadding</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="nx">uncollapsed_count</span><span class="o">++;</span>
				<span class="nx">sum</span> <span class="o">+=</span> <span class="nx">row_heights</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">uncollapsed_count</span> <span class="o">&lt;</span> <span class="nx">row_count</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">row_count</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="nx">row_heights</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">/</span> <span class="nx">sum</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c">// set height of each row and size of each module</span>

	<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">row_count</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">FIT_TO_CONTENT</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">row_heights</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">row_heights</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="kd">var</span> <span class="nx">module</span>   <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">_analyzeModule</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kd">var</span> <span class="nx">h1</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">insideHeight</span><span class="p">();</span>
					<span class="kd">var</span> <span class="nx">w</span>  <span class="o">=</span> <span class="nx">getWidth</span><span class="p">(</span><span class="nx">row_widths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">col_widths</span><span class="o">,</span> <span class="nx">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">module</span><span class="o">,</span> <span class="nx">module_info</span><span class="p">);</span>
					<span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">horizMarginBorderPadding</span><span class="p">());</span>
					<span class="nx">host</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;beforeResizeModule&#39;</span><span class="o">,</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="o">,</span> <span class="nx">h1</span><span class="o">,</span> <span class="nx">w1</span><span class="p">);</span>
					<span class="nx">host</span><span class="p">.</span><span class="nx">_setWidth</span><span class="p">(</span><span class="nx">children</span><span class="o">,</span> <span class="nx">w</span><span class="p">);</span>
					<span class="nx">host</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;afterResizeModule&#39;</span><span class="o">,</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="o">,</span> <span class="nx">h1</span><span class="o">,</span> <span class="nx">w1</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">continue</span><span class="o">;</span>
			<span class="p">}</span>

			<span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">body_height</span> <span class="o">*</span> <span class="nx">row_heights</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span> <span class="o">-</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">outers</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">vertMarginBorderPadding</span><span class="p">());</span>
		<span class="p">}</span>
		<span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">outers</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="nx">h</span><span class="o">+</span><span class="s1">&#39;px&#39;</span><span class="p">);</span>

		<span class="c">// adjust for horizontally collapsed or fixed width modules</span>

		<span class="kd">var</span> <span class="nx">modules</span>    <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">body_info</span><span class="p">.</span><span class="nx">modules</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
		<span class="kd">var</span> <span class="nx">total_w</span>    <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="kd">var</span> <span class="nx">open_count</span> <span class="o">=</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">size</span><span class="p">();</span>
		<span class="kd">var</span> <span class="nx">count</span>      <span class="o">=</span> <span class="nx">open_count</span><span class="o">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">count</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kd">var</span> <span class="nx">w</span>      <span class="o">=</span> <span class="nx">col_widths</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">];</span>
			<span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="kd">var</span> <span class="nx">total_w_hacked</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">w</span> <span class="o">==</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">unmanaged_size</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">_analyzeModule</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="kd">var</span> <span class="nx">h1</span> <span class="o">=</span> <span class="nx">adjustHeight</span><span class="p">(</span><span class="nx">h</span><span class="o">,</span> <span class="nx">children</span><span class="p">);</span>
						<span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">insideWidth</span><span class="p">();</span>
						<span class="nx">host</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;beforeResizeModule&#39;</span><span class="o">,</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="o">,</span> <span class="nx">h1</span><span class="o">,</span> <span class="nx">w1</span><span class="p">);</span>
						<span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="nx">h1</span><span class="o">+</span><span class="s1">&#39;px&#39;</span><span class="p">);</span>

						<span class="k">if</span> <span class="p">(</span><span class="nx">has_explosive_modules_bug</span><span class="p">)</span>
						<span class="p">{</span>
							<span class="kd">var</span> <span class="nx">bd_w</span> <span class="o">=</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">totalWidth</span><span class="p">();</span>
							<span class="nx">total_w</span> <span class="o">+=</span> <span class="nx">bd_w</span> <span class="o">+</span> <span class="nx">module</span><span class="p">.</span><span class="nx">horizMarginBorderPadding</span><span class="p">();</span>
							<span class="nx">total_w_hacked</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>

							<span class="nx">children</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="o">,</span> <span class="nx">bd_w</span><span class="o">+</span><span class="s1">&#39;px&#39;</span><span class="p">);</span>
						<span class="p">}</span>

						<span class="nx">host</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;afterResizeModule&#39;</span><span class="o">,</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="o">,</span> <span class="nx">h1</span><span class="o">,</span> <span class="nx">w1</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span>
				<span class="p">{</span>
					<span class="nx">module</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">module</span><span class="p">.</span><span class="nx">vertMarginBorderPadding</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;px&#39;</span><span class="p">);</span>
				<span class="p">}</span>

				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">total_w_hacked</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="nx">total_w</span> <span class="o">+=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">totalWidth</span><span class="p">();</span>
				<span class="p">}</span>
				<span class="nx">open_count</span><span class="o">--;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="c">// set the size of each module</span>

		<span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">count</span><span class="o">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">col_widths</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">continue</span><span class="o">;</span>
			<span class="p">}</span>
			<span class="nx">k</span><span class="o">++;</span>

			<span class="kd">var</span> <span class="nx">module</span>   <span class="o">=</span> <span class="nx">modules</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">j</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">_analyzeModule</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="kd">var</span> <span class="nx">h1</span>   <span class="o">=</span> <span class="nx">adjustHeight</span><span class="p">(</span><span class="nx">h</span><span class="o">,</span> <span class="nx">children</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">w</span>    <span class="o">=</span> <span class="nx">getWidth</span><span class="p">(</span><span class="nx">row_widths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">col_widths</span><span class="o">,</span> <span class="nx">i</span><span class="o">,</span> <span class="nx">j</span><span class="o">,</span> <span class="nx">module</span><span class="o">,</span> <span class="nx">module_info</span><span class="p">);</span>
				<span class="nx">total_w</span> <span class="o">+=</span> <span class="nx">w</span> <span class="o">+</span> <span class="nx">module_info</span><span class="p">.</span><span class="nx">mbp</span><span class="o">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">==</span> <span class="nx">open_count</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="nx">w</span> <span class="o">+=</span> <span class="nx">body_width</span> <span class="o">-</span> <span class="nx">total_w</span><span class="o">;</span>
				<span class="p">}</span>

				<span class="kd">var</span> <span class="nx">w1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">w</span> <span class="o">-</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">horizMarginBorderPadding</span><span class="p">());</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">===</span> <span class="nx">Y</span><span class="p">.</span><span class="nx">PageLayout</span><span class="p">.</span><span class="nx">FIT_TO_VIEWPORT</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="nx">host</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;beforeResizeModule&#39;</span><span class="o">,</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="o">,</span> <span class="nx">h1</span><span class="o">,</span> <span class="nx">w1</span><span class="p">);</span>
					<span class="nx">host</span><span class="p">.</span><span class="nx">_setWidth</span><span class="p">(</span><span class="nx">children</span><span class="o">,</span> <span class="nx">w</span><span class="p">);</span>
				<span class="p">}</span>

				<span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="p">.</span><span class="nx">setStyle</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="o">,</span> <span class="nx">h1</span><span class="o">+</span><span class="s1">&#39;px&#39;</span><span class="p">);</span>

				<span class="nx">host</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="s1">&#39;afterResizeModule&#39;</span><span class="o">,</span> <span class="nx">children</span><span class="p">.</span><span class="nx">bd</span><span class="o">,</span> <span class="nx">h1</span><span class="o">,</span> <span class="nx">w1</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</pre></div>

                    </div>
			</div>
		</div>
		<div class="yui-b">
            <div class="nav">

                    <div id="moduleList" class="module">
                        <h4>Modules</h4>
                        <ul class="content">
                                <li class=""><a href="module_gallery-accordion-horiz-vert.html" title="gallery-accordion-horiz-vert">gallery-accordion-horiz-vert</a></li>
                                <li class=""><a href="module_gallery-algorithms.html" title="gallery-algorithms">gallery-algorithms</a></li>
                                <li class=""><a href="module_gallery-anim-class.html" title="gallery-anim-class">gallery-anim-class</a></li>
                                <li class=""><a href="module_gallery-bulkedit.html" title="gallery-bulkedit">gallery-bulkedit</a></li>
                                <li class=""><a href="module_gallery-busyoverlay.html" title="gallery-busyoverlay">gallery-busyoverlay</a></li>
                                <li class=""><a href="module_gallery-canvas.html" title="gallery-canvas">gallery-canvas</a></li>
                                <li class=""><a href="module_gallery-checkboxgroups.html" title="gallery-checkboxgroups">gallery-checkboxgroups</a></li>
                                <li class=""><a href="module_gallery-chipper.html" title="gallery-chipper">gallery-chipper</a></li>
                                <li class=""><a href="module_gallery-complexnumber.html" title="gallery-complexnumber">gallery-complexnumber</a></li>
                                <li class=""><a href="module_gallery-console-test.html" title="gallery-console-test">gallery-console-test</a></li>
                                <li class=""><a href="module_gallery-expiration-cache.html" title="gallery-expiration-cache">gallery-expiration-cache</a></li>
                                <li class=""><a href="module_gallery-exprbuilder.html" title="gallery-exprbuilder">gallery-exprbuilder</a></li>
                                <li class=""><a href="module_gallery-formmgr.html" title="gallery-formmgr">gallery-formmgr</a></li>
                                <li class=""><a href="module_gallery-formmgr-css-validation.html" title="gallery-formmgr-css-validation">gallery-formmgr-css-validation</a></li>
                                <li class=""><a href="module_gallery-formmgr-overlay-plugin.html" title="gallery-formmgr-overlay-plugin">gallery-formmgr-overlay-plugin</a></li>
                                <li class=""><a href="module_gallery-funcprog.html" title="gallery-funcprog">gallery-funcprog</a></li>
                                <li class=""><a href="module_gallery-instancemanager.html" title="gallery-instancemanager">gallery-instancemanager</a></li>
                                <li class=""><a href="module_gallery-iterable-extras.html" title="gallery-iterable-extras">gallery-iterable-extras</a></li>
                                <li class="selected"><a href="module_gallery-layout.html" title="gallery-layout">gallery-layout</a></li>
                                <li class=""><a href="module_gallery-linkedlist.html" title="gallery-linkedlist">gallery-linkedlist</a></li>
                                <li class=""><a href="module_gallery-math.html" title="gallery-math">gallery-math</a></li>
                                <li class=""><a href="module_gallery-mathcanvas.html" title="gallery-mathcanvas">gallery-mathcanvas</a></li>
                                <li class=""><a href="module_gallery-mru-cache.html" title="gallery-mru-cache">gallery-mru-cache</a></li>
                                <li class=""><a href="module_gallery-multiobject.html" title="gallery-multiobject">gallery-multiobject</a></li>
                                <li class=""><a href="module_gallery-neon.html" title="gallery-neon">gallery-neon</a></li>
                                <li class=""><a href="module_gallery-nodelist-extras2.html" title="gallery-nodelist-extras2">gallery-nodelist-extras2</a></li>
                                <li class=""><a href="module_gallery-object-extras.html" title="gallery-object-extras">gallery-object-extras</a></li>
                                <li class=""><a href="module_gallery-paginator.html" title="gallery-paginator">gallery-paginator</a></li>
                                <li class=""><a href="module_gallery-querybuilder.html" title="gallery-querybuilder">gallery-querybuilder</a></li>
                                <li class=""><a href="module_gallery-quickedit.html" title="gallery-quickedit">gallery-quickedit</a></li>
                                <li class=""><a href="module_gallery-test-extras.html" title="gallery-test-extras">gallery-test-extras</a></li>
                                <li class=""><a href="module_gallery-treeble.html" title="gallery-treeble">gallery-treeble</a></li>
                                <li class=""><a href="module_io.html" title="io">io</a></li>
                                <li class=""><a href="module_node.html" title="node">node</a></li>
                        </ul>
                    </div>

                    <div id="classList" class="module">
                        <h4>Classes</h4>
                        <ul class="content">
                                <li class=""><a href="PageLayout.html" title="PageLayout">PageLayout</a></li>
                        </ul>
                    </div>

                    <div id="fileList" class="module">
                        <h4>Files</h4>
                        <ul class="content">        
                                <li class=""><a href="PageLayout.js.html" title="PageLayout.js">PageLayout.js</a></li>
                                <li class=""><a href="PageLayoutCols.js.html" title="PageLayoutCols.js">PageLayoutCols.js</a></li>
                                <li class="selected"><a href="PageLayoutRows.js.html" title="PageLayoutRows.js">PageLayoutRows.js</a></li>
                        </ul>
                    </div>





            </div>
		</div>
	</div>
	<div id="ft">
        <hr />
        Copyright &copy; 2012 Yahoo! Inc. All rights reserved.
	</div>
</div>
<script type="text/javascript">

    var ALL_YUI_PROPS = [{"url": "PageLayout.html#event_afterCollapseModule", "access": "", "host": "PageLayout", "type": "event", "name": "afterCollapseModule"}, {"url": "PageLayout.html#event_afterExpandModule", "access": "", "host": "PageLayout", "type": "event", "name": "afterExpandModule"}, {"url": "PageLayout.html#event_afterReflow", "access": "", "host": "PageLayout", "type": "event", "name": "afterReflow"}, {"url": "PageLayout.html#event_afterResizeModule", "access": "", "host": "PageLayout", "type": "event", "name": "afterResizeModule"}, {"url": "PageLayout.html#event_beforeCollapseModule", "access": "", "host": "PageLayout", "type": "event", "name": "beforeCollapseModule"}, {"url": "PageLayout.html#event_beforeExpandModule", "access": "", "host": "PageLayout", "type": "event", "name": "beforeExpandModule"}, {"url": "PageLayout.html#event_beforeReflow", "access": "", "host": "PageLayout", "type": "event", "name": "beforeReflow"}, {"url": "PageLayout.html#event_beforeResizeModule", "access": "", "host": "PageLayout", "type": "event", "name": "beforeResizeModule"}, {"url": "PageLayout.html#method_collapseModule", "access": "", "host": "PageLayout", "type": "method", "name": "collapseModule"}, {"url": "PageLayout.html#method_elementResized", "access": "", "host": "PageLayout", "type": "method", "name": "elementResized"}, {"url": "PageLayout.html#method_expandModule", "access": "", "host": "PageLayout", "type": "method", "name": "expandModule"}, {"url": "PageLayout.html#method_getBodyContainer", "access": "", "host": "PageLayout", "type": "method", "name": "getBodyContainer"}, {"url": "PageLayout.html#method_getBodyHeight", "access": "", "host": "PageLayout", "type": "method", "name": "getBodyHeight"}, {"url": "PageLayout.html#method_getFooterContainer", "access": "", "host": "PageLayout", "type": "method", "name": "getFooterContainer"}, {"url": "PageLayout.html#method_getFooterHeight", "access": "", "host": "PageLayout", "type": "method", "name": "getFooterHeight"}, {"url": "PageLayout.html#method_getHeaderContainer", "access": "", "host": "PageLayout", "type": "method", "name": "getHeaderContainer"}, {"url": "PageLayout.html#method_getHeaderHeight", "access": "", "host": "PageLayout", "type": "method", "name": "getHeaderHeight"}, {"url": "PageLayout.html#config_matchColumnHeights", "access": "", "host": "PageLayout", "type": "config", "name": "matchColumnHeights"}, {"url": "PageLayout.html#config_minHeight", "access": "", "host": "PageLayout", "type": "config", "name": "minHeight"}, {"url": "PageLayout.html#config_minWidth", "access": "", "host": "PageLayout", "type": "config", "name": "minWidth"}, {"url": "PageLayout.html#config_mode", "access": "", "host": "PageLayout", "type": "config", "name": "mode"}, {"url": "PageLayout.html#method_moduleIsCollapsed", "access": "", "host": "PageLayout", "type": "method", "name": "moduleIsCollapsed"}, {"url": "PageLayout.html#method_rescanBody", "access": "", "host": "PageLayout", "type": "method", "name": "rescanBody"}, {"url": "PageLayout.html#config_stickyFooter", "access": "", "host": "PageLayout", "type": "config", "name": "stickyFooter"}, {"url": "PageLayout.html#method_toggleModule", "access": "", "host": "PageLayout", "type": "method", "name": "toggleModule"}, {"url": "PageLayout.html#property_Y.PageLayout.collapsed_horiz_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.collapsed_horiz_class"}, {"url": "PageLayout.html#property_Y.PageLayout.collapsed_vert_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.collapsed_vert_class"}, {"url": "PageLayout.html#property_Y.PageLayout.collapse_left_nub_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.collapse_left_nub_class"}, {"url": "PageLayout.html#property_Y.PageLayout.collapse_right_nub_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.collapse_right_nub_class"}, {"url": "PageLayout.html#property_Y.PageLayout.collapse_vert_nub_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.collapse_vert_nub_class"}, {"url": "PageLayout.html#property_Y.PageLayout.expand_left_nub_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.expand_left_nub_class"}, {"url": "PageLayout.html#property_Y.PageLayout.expand_right_nub_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.expand_right_nub_class"}, {"url": "PageLayout.html#property_Y.PageLayout.expand_vert_nub_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.expand_vert_nub_class"}, {"url": "PageLayout.html#property_Y.PageLayout.FIT_TO_CONTENT", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.FIT_TO_CONTENT"}, {"url": "PageLayout.html#property_Y.PageLayout.FIT_TO_VIEWPORT", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.FIT_TO_VIEWPORT"}, {"url": "PageLayout.html#property_Y.PageLayout.min_module_height", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.min_module_height"}, {"url": "PageLayout.html#property_Y.PageLayout.module_body_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.module_body_class"}, {"url": "PageLayout.html#property_Y.PageLayout.module_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.module_class"}, {"url": "PageLayout.html#property_Y.PageLayout.module_cols_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.module_cols_class"}, {"url": "PageLayout.html#property_Y.PageLayout.module_footer_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.module_footer_class"}, {"url": "PageLayout.html#property_Y.PageLayout.module_header_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.module_header_class"}, {"url": "PageLayout.html#property_Y.PageLayout.module_rows_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.module_rows_class"}, {"url": "PageLayout.html#property_Y.PageLayout.not_managed_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.not_managed_class"}, {"url": "PageLayout.html#property_Y.PageLayout.page_body_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.page_body_class"}, {"url": "PageLayout.html#property_Y.PageLayout.page_footer_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.page_footer_class"}, {"url": "PageLayout.html#property_Y.PageLayout.page_header_class", "access": "", "host": "PageLayout", "type": "property", "name": "Y.PageLayout.page_header_class"}];
</script>
</body>
</html>
