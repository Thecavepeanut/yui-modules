YUI.add("gallery-io-multiresponse",function(A){var H=A.Lang,I=A.config.win,F=A.config.doc,D=(F.documentMode&&F.documentMode>=8),E=decodeURIComponent;function J(M,O,N){var L=A.Node.create('<iframe id="io-multi-response-'+M.id+'" name="io-multi-response-'+M.id+'" />');L._node.style.position="absolute";L._node.style.top="-1000px";L._node.style.left="-1000px";A.one("body").appendChild(L);A.on("load",function(){N._multi_complete(M,O);},"#io-multi-response-"+M.id);}function K(N){var M=A.guid("io-multi-response-form-"),L=A.Node.create('<form id="'+M+'" name="'+M+'" />');L._node.style.position="absolute";L._node.style.top="-1000px";L._node.style.left="-1000px";A.one("body").appendChild(L);return M;}A.mix(A.IO.prototype,{_addJSON:function(N,M){if(!A.Lang.isString(M)){M=A.JSON.stringify(M);}var L=F.createElement("input");L.type="hidden";L.name="json";L.value=M;N.appendChild(L);return L;},_multi_setAttrs:function(M,O,L,N){M.setAttribute("action",L);M.setAttribute("method",N||"POST");M.setAttribute("target","io-multi-response-"+O);M.setAttribute(A.UA.ie&&!D?"encoding":"enctype","multipart/form-data");},_multi_startTimeout:function(L,N){var M=this;M._timeout[L.id]=I.setTimeout(function(){L.status=0;L.statusText="timeout";M.end(L,N);},N.timeout);},_multi_destroy:function(M,L){if(!L.debug){A.Event.purgeElement("#io-multi-response-"+M,false);A.one("body").removeChild(A.one("#io-multi-response-"+M));}if(L.form.id.indexOf("io-multi-response-form-")===0){A.one("body").removeChild(A.one("#"+L.form.id));}},_multi_complete:function(L,N){var M=this;if(N.timeout){M._clearTimeout(L.id);}M.end(L,N);I.setTimeout(function(){M._multi_destroy(L.id,N);},0);},_multi_send:function(Q,N,S){var R=this,P=(typeof S.form.id==="string")?F.getElementById(S.form.id):S.form.id,M={method:P.getAttribute("method"),action:P.getAttribute("action"),target:P.getAttribute("target")},L=[];R._multi_setAttrs(P,Q.id,N,S.method);if(S.data){var O=S.data;if(H.isObject(O)){O=A.QueryString.stringify(O);}L=R._addData(P,O);}if(S.json){L.push(R._addJSON(P,S.json));}if(S.timeout){R._multi_startTimeout(Q,S);}P.submit();R.start(Q,S);if(S.data){R._removeData(P,L);}R._resetAttrs(P,M);return{id:Q.id,abort:function(){Q.status=0;Q.statusText="abort";if(A.one("#io-multi-response-"+Q.id)){R._multi_destroy(Q.id,S);R.end(Q,S);}else{return false;}},isInProgress:function(){return A.one("#io-multi-response-"+Q.id)?true:false;},io:R};}});var G=A.IO.prototype._init;A.IO.prototype._init=function(L){G.apply(this,arguments);this.publish("io:response",A.merge({broadcast:1},L));this.publish("io-trn:response",L);};var B=A.IO.prototype.upload;A.IO.prototype.upload=function(O,L,Q){if(!Q.multiresponse){return B.apply(this,arguments);}var P=this;YUI.Env.io_multi_response_callback[O.id]=function(R){if(!R){A.error("Callback "+O.id+" invoked without data.",null,"io");return;}if(Q.timeout){P._clearTimeout(O.id);P._multi_startTimeout(O,Q);}if(Q.on&&Q.on.response){O.c=R;P._evt("response",O,Q);}};var M=encodeURIComponent("window.parent.YUI.Env.io_multi_response_callback["+O.id+"]");var N="callback="+M;if(!Q.data){Q.data=N;}else{if(H.isObject(Q.data)){Q.data.callback=M;}else{Q.data=Q.data+"&"+N;}}if(Q.form&&!Q.form.id){delete Q.form;}J(O,Q,P);return P._multi_send(O,L,Q);};if(!YUI.Env.io_multi_response_callback){YUI.Env.io_multi_response_callback=[];}var C=A.io;A.io=function(L,M){if(M.multiresponse&&!M.form){M.form={id:K(M),upload:true};}else{if(M.multiresponse&&!M.form.upload){M.form.upload=true;}}C.call(this,L,M);};A.mix(A.io,C);},"@VERSION@",{optional:["json-stringify"],requires:["io-upload-iframe"]});