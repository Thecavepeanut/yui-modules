YUI.add("gallery-jsonrpc",function(E){var B=E.Lang.isObject,D=E.Lang.isFunction,C=E.Array,A=function(){};function F(H){var G=H&&H.methods,I;H=this._config=E.merge({context:this,method:"POST"},H);if(!("preload" in H)){H.preload=!G;}F.init.apply(this,arguments);if(G){for(I=G.length-1;I>=0;--I){F.addMethod(this,G[I]);}}if(H.preload){this.loadAPI();}}E.JSONRPC=E.mix(F,{defaults:{version:2,sync:false,contentType:"application/json"},addMethod:function(I,G,H){if(H||!I[G]){I[G]=function(){var J=C(arguments,0,true),K;if(B(J[J.length-1])){K=J.pop();}return this.exec(G,J,K);};}},init:function(){E.mix(this._config,F.defaults);this.publish("dispatch",{emitFacade:true,defaultFn:F._defDispatchFn});},_defDispatchFn:function(G){G.ioConfig.data=E.JSON.stringify(G.rpcPayload);E.io(G.url,G.ioConfig);},prototype:{exec:function(N,L,M){var J={method:N},I=this._config,G={headers:{"Content-Type":I.contentType+"; charset=utf-8"},method:I.method,sync:I.sync,on:{}},K,H;if(D(M)){M={on:{success:M}};}E.aggregate(G,M,true);if(L){J.params=L;}if(I.serverParams){E.mix(J,I.serverParams);}if(I.version>1){J.jsonrpc=I.version.toFixed(1);}if(M){J.id=E.guid();K=M.on.success;H=M.on.failure;if(K){G.on.success=function(R,O){var P;try{P=E.JSON.parse(O.responseText);}catch(Q){P={error:{code:-32700,message:"Parse error"},id:null};}if(P.error){if(H){H.call(G.context,P.error);}}else{K.call(G.context,P.result);}};}}return this.fire("dispatch",{url:I.url,method:N,params:L,callback:M,rpcPayload:J,ioConfig:G});},loadAPI:function(){var G=this._config;E.io(G.url,{headers:{"Content-Type":G.contentType+"; charset=utf-8"},sync:G.sync,on:{success:function(L,H){var J,I;try{J=E.JSON.parse(H.responseText);}catch(K){E.error("Unable to parse remote API response",K);}if(J.envelope==="JSON-RPC-1.0"){G.version=1;}if(J.methods){for(I=J.methods.length-1;I>=0;--I){F.addMethod(this,J.methods[I]);}}this.fire("apiready");},failure:function(){E.error("Unable to load remote API");this.fire("apierror");}},context:this});return this;}}},true);E.augment(F,E.EventTarget);E.jsonrpc=function(H,K,I,J,G){if(H&&K){return new E.JSONRPC(E.mix(G,{url:H,preload:false},true)).exec(K,I,J);}};},"@VERSION@",{requires:["io-base","event-custom","json"]});