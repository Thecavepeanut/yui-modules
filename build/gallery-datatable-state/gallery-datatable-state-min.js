YUI.add("gallery-datatable-state",function(e,t){"use strict";function n(e){n.superclass.constructor.call(this,e)}function r(e,t){delete t[e]}function i(t){e.each(this.state,e.bind(r,null,t))}function s(){var t=this.get("host")._displayColumns;e.each(this.get("save"),function(n){n.column_index=e.Array.findIndexOf(t,function(e){return e.key===n.column}),n.column_index<0&&i.call(this,n.column)},this)}function o(){var t=this.get("host"),n=t.data.size(),r=this.get("uniqueIdKey");e.each(this.get("save"),function(i){if(i.column_index<0)return;for(var s=0;s<n;s++){var o=null,u=t.getCell([s,i.column_index]);if(u)if(i.node){var a=u.one(i.node);a&&(o=a.get(i.key))}else if(i.widget){var f=e.Widget.getByNode(u.one(i.widget));f&&(o=f.get(i.key))}var l=t.getRecord(s),c=l.get(r);this.state[c]||(this.state[c]={}),this.state[c][i.column]=o}},this)}function u(){var t=this.get("host"),n=t.data.size(),r=this.get("uniqueIdKey");e.each(this.get("save"),function(i){if(i.column_index<0)return;for(var s=0;s<n;s++){var o=t.getRecord(s),u=this.state[o.get(r)];if(u){var a=u[i.column],f=t.getCell([s,i.column_index]);if(f)if(i.node){var l=f.one(i.node);l&&l.set(i.key,a)}else if(i.widget){var c=e.Widget.getByNode(f.one(i.widget));c&&c.set(i.key,a)}}}},this)}function a(){e.each(this.get("save"),function(e){(e.column_index<0||e.temp)&&i.call(this,e.column)},this)}function f(e){e.on("datatable-state-paginator|changeRequest",a,this)}n.NAME="DataTableStatePlugin",n.NS="state",n.ATTRS={uniqueIdKey:{validator:e.Lang.isString},save:{value:[],validator:e.Lang.isArray},paginator:{validator:function(t){return!t||e.Lang.isObject(t)}}},e.extend(n,e.Plugin.Base,{initializer:function(t){this.state={},this.on("uniqueIdKeyChange",function(){this.state={}}),t.paginator&&f.call(this,t.paginator),this.on("paginatorChange",function(t){e.detach("datatable-state-paginator|*"),t.newVal&&f.call(this,t.newVal)}),s.call(this),this.after("saveChange",s),this.afterHostEvent("columnsChange",s);var n=this.get("host"),r=this,i=this.orig_syncUI=n.syncUI;n.syncUI=function(){o.call(r),i.apply(n,arguments),u.call(r)},this.onHostEvent("dataChange",o),this.afterHostEvent("dataChange",function(){e.later(0,this,u)})},destructor:function(){this.get("host").syncUI=this.orig_syncUI},getState:function(){return o.call(this),this.state}}),e.namespace("Plugin"),e.Plugin.DataTableState=n},"@VERSION@",{requires:["datatable","plugin","gallery-funcprog","gallery-node-optimizations"]});
