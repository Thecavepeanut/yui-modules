YUI.add("gallery-matrix-credits",function(e,t){"use strict";function n(e){this.timer={},n.superclass.constructor.call(this,e)}function a(){var t=this.get("textSequence"),n=t[this.page_index],r=this.page_index==t.length-1?"restartDelay":"pagePause";e.later(n.pause||this.get(r),this,f)}function f(){var t=this.get("textSequence");this.page_index++,this.page_index>=t.length&&(this.page_index=0);var n=t[this.page_index],r=e.reduce(n.intro||[],"",function(e,t){return e+"<p>"+(t||"&nbsp;")+"</p>"}),i=e.reduce(n.lines||[],"",function(e,t){e+="<p><span>";for(var n=0;n<t.length;n++)e+="&nbsp;";return e+"</span></p>"});this.frame.setContent(r+i),this.frame_top=Math.floor((this.get("height")-this.frame.totalHeight())/2),this.frame.setStyle("top",this.frame_top+"px"),n.lines?(this.frame_lines=this.frame.all("span"),this.cursor_pt={row:-1,col:-1},this.cursor_top=this.frame_top-this.frame.totalHeight(),l.call(this),p.call(this)):a.call(this)}function l(){this.cursor.removeClass("hidden"),s.call(this,"cursor");var e=this.get("textSequence")[this.page_index].lines;do this.cursor_pt.row++;while(e[this.cursor_pt.row]=="&nbsp;");this.cursor_pt.col=-1,this.spin_index=0,this.spin_count=0}function c(){this.cursor.addClass("hidden"),this.cursor.setStyles({top:0,left:0}),o.call(this,"cursor")}function h(){this.cursor_pt.col++;if(parseInt(this.cursor.getStyle("left"),10)>this.get("width")){c.call(this),m.call(this);return}var e=this.cursor_width*this.cursor_pt.col,t=this.frame_lines.item(this.cursor_pt.row);this.cursor.setStyles({top:this.cursor_top+t.get("offsetTop")+"px",left:e+"px"}),this.spin_index===0&&e>t.get("offsetLeft")?(this.spin_index++,this.spin_text=t.get("innerHTML").replace(/&nbsp;/g," ").split(""),this.end_text=this.get("textSequence")[this.page_index].lines[this.cursor_pt.row].split("")):0<this.spin_index&&this.spin_index<this.spin_text.length&&this.spin_index++}function p(){this.bkgd?this.spin_handle=this.bkgd.on("spin",v,this):s.call(this,"spin")}function d(){this.spin_handle?(this.spin_handle.detach(),this.spin_handle=null):o.call(this,"spin")}function v(){if(this.timer.cursor&&this.get("cursor")=="char"){var e=u.call(this.bkgd||this);this.cursor.set("innerHTML",String.fromCharCode(i(e[0],e[1]+1)))}if(this.spin_index>0){var t=this.frame_lines.item(this.cursor_pt.row),e=u.call(this),n=0;for(var r=0;r<this.spin_index;r++){if(this.spin_text[r]===this.end_text[r]){n++;continue}this.spin_text[r]=String.fromCharCode(i(e[0],e[1]+1))}this.spin_count++,this.spin_count>this.get("maxPhaseCount")&&(this.spin_text=this.end_text.slice(0),n=this.spin_text.length),t.set("innerHTML",this.spin_text.join("").replace(/\s/g,"&nbsp;")),n>=this.spin_text.length&&(d.call(this),m.call(this))}}function m(){if(this.timer.cursor||this.spin_handle||this.timer.spin)return;this.cursor_pt.row>=this.frame_lines.size()-1?a.call(this):(l.call(this),p.call(this))}function g(){var e=this.get("cursor");e=="block"?this.cursor.set("innerHTML","\u2588"):this.cursor.set("innerHTML","&nbsp;"),this.cursor_width=this.cursor.get("offsetWidth")}function y(){this.set("width",e.DOM.winWidth()),this.set("height",e.DOM.winHeight())}n.NAME="matrixcredits",n.ATTRS={textSequence:{value:[],validator:e.Lang.isArray},introDelay:{value:5e3,validator:e.Lang.isNumber},pagePause:{value:2e3,validator:e.Lang.isNumber},restartDelay:{value:5e3,validator:e.Lang.isNumber},cursor:{value:"block",validator:function(e){return e=="none"||e=="block"||e=="char"}},maxPhaseCount:{value:20,validator:e.Lang.isNumber},charRange:{value:["!","~"],validator:function(t){return e.Lang.isArray(t)&&t.length==2&&t[0].length==1&&t[1].length==1&&t[0]<t[1]}},background:{value:e.Plugin.MatrixBackground,writeOnce:!0,validator:function(t){return t===null||t instanceof e.Plugin.Base}},backgroundConfig:{writeOnce:!0}};var r={cursor:30,spin:10},i=e.Plugin.MatrixBackground.rnd,s=e.Plugin.MatrixBackground.startTimer,o=e.Plugin.MatrixBackground.stopTimer,u=e.Plugin.MatrixBackground.getCharacterRange;e.extend(n,e.Widget,{initializer:function(e){this.on("cursor",h),this.on("spin",v)},destructor:function(){o.call(this,"cursor")},bindUI:function(){this.get("boundingBox").ancestor()==e.one("body")&&(y.call(this),e.on("windowresize",y,this))},syncUI:function(){var t=this.get("background");if(t){var n=this.get("boundingBox");n.plug(t,this.get("backgroundConfig")),this.bkgd=n.matrix}this.frame=e.Node.create('<div class="frame"></div>'),this.get("contentBox").append(this.frame),this.cursor=e.Node.create('<span class="cursor hidden"></span>'),this.get("contentBox").append(this.cursor),g.call(this),this.after("cursorChange",g),this.page_index=-1,e.later(this.get("introDelay"),this,f)}}),e.MatrixCredits=n},"@VERSION@",{skinnable:"true",requires:["widget","gallery-matrix-background","gallery-funcprog"]});
