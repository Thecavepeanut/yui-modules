YUI.add("gallery-datatable-row-expansion",function(d){function c(e){c.superclass.constructor.call(this,e);}c.NAME="DataTableRowExpansionPlugin";c.NS="rowexpander";c.ATTRS={template:{value:"",validator:function(e){return(d.Lang.isString(e)||d.Lang.isFunction(e));}},uniqueIdKey:{value:"",validator:d.Lang.isString}};c.column_key="row-expander";function a(f){var j=this.rowexpander;var e=f.data[j.get("uniqueIdKey")];var h=j.open_rows[e];f.td.addClass("row-toggle");f.td.replaceClass("row-(open|closed)",h?"row-open":"row-closed");f.td.on("click",function(){j.open_rows[e]=!j.open_rows[e];d.later(0,this,function(){this.syncUI();});},this);f.cell.set("innerHTML",'<a class="row-expand-nub" href="javascript:void(0);"></a>');if(h){var m="";for(var g=0;g<=j.col_count.pre;g++){m+='<td class="yui3-datatable-cell pre-row-expansion">&nbsp;</td>';}var l=j.get("template");if(d.Lang.isFunction(l)){var p=l.call(this,f.data);}else{var p=d.Lang.sub(l,f.data);}var n=f.cell.ancestor();var k=d.Lang.sub('<tr class="{c}">'+"{pre}"+'<td colspan="{post}" class="yui3-datatable-cell post-row-expansion">{tmpl}</td>'+"</tr>",{c:n.get("className")+" row-expansion",pre:m,post:j.col_count.post,tmpl:p});n.insert(k,"after");}}function b(){function e(f,g){if(g.key==c.column_key){g.nodeFormatter=a;f.found=true;}else{if(g.children){f=d.reduce(g.children,f,e);}else{f[f.found?"post":"pre"]++;}}return f;}this.col_count=d.reduce(this.get("host").get("columns"),{pre:0,post:0,found:false},e);}d.extend(c,d.Plugin.Base,{initializer:function(e){this.open_rows={};this.on("uniqueIdKeyChange",function(){this.open_rows={};});b.call(this);this.afterHostEvent("columnsChange",b);}});d.namespace("Plugin");d.Plugin.RowExpansion=c;},"@VERSION@",{requires:["datatable","plugin","gallery-funcprog"]});