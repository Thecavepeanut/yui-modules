<!DOCTYPE HTML>
<html>

<head>
	<title>Layout Manager Example</title>
	<meta http-equiv=content-type content="text/html; charset=utf-8">

	<script src="http://yui.yahooapis.com/3.4.1/build/yui/yui-min.js"></script>
	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.4.1/build/cssreset/reset-min.css">
	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.4.1/build/cssfonts/fonts-min.css">
	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.4.1/build/cssbase/base-min.css">

	<script type="text/javascript" src="http://yui.yahooapis.com/combo?3.4.1/build/oop/oop-min.js&amp;3.4.1/build/event-custom-base/event-custom-base-min.js&amp;3.4.1/build/event-custom-complex/event-custom-complex-min.js&amp;3.4.1/build/attribute-base/attribute-base-min.js&amp;3.4.1/build/attribute-complex/attribute-complex-min.js&amp;3.4.1/build/base-base/base-base-min.js&amp;3.4.1/build/pluginhost-base/pluginhost-base-min.js&amp;3.4.1/build/pluginhost-config/pluginhost-config-min.js&amp;3.4.1/build/base-pluginhost/base-pluginhost-min.js&amp;3.4.1/build/base-build/base-build-min.js&amp;3.4.1/build/array-extras/array-extras-min.js&amp;3.4.1/build/dom-core/dom-core-min.js&amp;3.4.1/build/dom-base/dom-base-min.js&amp;3.4.1/build/selector-native/selector-native-min.js&amp;3.4.1/build/selector/selector-min.js&amp;3.4.1/build/node-core/node-core-min.js&amp;3.4.1/build/node-base/node-base-min.js&amp;3.4.1/build/event-base/event-base-min.js&amp;3.4.1/build/dom-style/dom-style-min.js&amp;3.4.1/build/node-style/node-style-min.js&amp;3.4.1/build/arraylist/arraylist-min.js&amp;3.4.1/build/recordset-base/recordset-base-min.js&amp;3.4.1/build/event-synthetic/event-synthetic-min.js&amp;3.4.1/build/event-focus/event-focus-min.js&amp;3.4.1/build/classnamemanager/classnamemanager-min.js&amp;3.4.1/build/widget-base/widget-base-min.js&amp;3.4.1/build/widget-htmlparser/widget-htmlparser-min.js&amp;3.4.1/build/event-delegate/event-delegate-min.js&amp;3.4.1/build/node-event-delegate/node-event-delegate-min.js&amp;3.4.1/build/widget-uievents/widget-uievents-min.js&amp;3.4.1/build/widget-skin/widget-skin-min.js&amp;3.4.1/build/substitute/substitute-min.js&amp;3.4.1/build/event-mouseenter/event-mouseenter-min.js&amp;3.4.1/build/datatable-base/datatable-base-min.js&amp;3.4.1/build/plugin/plugin-min.js&amp;3.4.1/build/datasource-local/datasource-local-min.js&amp;3.4.1/build/datatable-datasource/datatable-datasource-min.js&amp;3.4.1/build/datatable-scroll/datatable-scroll-min.js&amp;3.4.1/build/event-key/event-key-min.js&amp;3.4.1/build/intl/intl-min.js" charset="utf-8"></script>
	<script type="text/javascript" src="http://yui.yahooapis.com/combo?gallery-2012.01.11-21-03/build/gallery-nodelist-extras/gallery-nodelist-extras-min.js" charset="utf-8"></script>
	<script type="text/javascript" src="http://yui.yahooapis.com/combo?3.4.1/build/node-pluginhost/node-pluginhost-min.js&amp;3.4.1/build/dom-screen/dom-screen-min.js&amp;3.4.1/build/node-screen/node-screen-min.js" charset="utf-8"></script>

	<script src="gallery-layout-debug.js"></script>
	<script src="gallery-layout-rows-debug.js"></script>
	<script src="gallery-dimensions-debug.js"></script>
	<script src="gallery-node-optimizations-debug.js"></script>
	<script src="gallery-funcprog-debug.js"></script>
	<script src="gallery-object-extras-debug.js"></script>
	<script src="gallery-nodelist-extras2-debug.js"></script>
	<script src="gallery-paginator-debug.js"></script>
	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?3.4.1/build/widget-base/assets/skins/sam/widget-base.css&3.4.1/build/datatable-base/assets/skins/sam/datatable-base.css" />
	<link rel="stylesheet" type="text/css" href="assets/gallery-layout.css">
	<link rel="stylesheet" type="text/css" href="assets/gallery-paginator.css" />

	<style type="text/css">
	.layout-hd,.layout-ft {text-align:center;}
	.layout-hd h1 {font-size:150%;font-weight:bold;margin:0;padding:5px 0;}
	.layout-hd p {margin:0;padding-bottom:13px;}

	.layout-bd .layout-module-row {padding:0 0 10px 0;}
	.layout-bd .layout-module {margin:0 5px;border-radius:10px;}
	.layout-bd .layout-m-hd {background-color:#EEE;border-top-left-radius:10px;border-top-right-radius:10px;border-bottom:1px solid #666;}
	.layout-bd .layout-m-ft {background-color:#EEE;border-top:1px solid #666;}
	.layout-bd .layout-m-ft,
	.layout-bd .layout-collapsed-vert .layout-m-hd {border-bottom-left-radius:10px;border-bottom-right-radius:10px;}
	.layout-bd .layout-collapsed-vert .layout-m-hd {border-bottom:0;}

	.layout-bd .layout-m-hd,
	.layout-bd .layout-m-ft {padding:5px;}

	.layout-bd .layout-m-hd p,
	.layout-bd .layout-m-ft p {margin:0}

	.layout-ft {background-color:#CCC;}
	.layout-ft p {font-size:80%;color:#666;margin:0;padding:0 0 10px 0;}

	.layout-bd .layout-module .datatable-m-bd {overflow:hidden;}
	.yui3-skin-sam .layout-bd .yui3-datatable-hd,
	.yui3-skin-sam .layout-bd .yui3-datatable-bd {border:0;}
	</style>
</head>
<!--  .yui3-datatable-scrollable .yui3-datatable-bd -->
<body class="yui3-skin-sam">

<div class="layout-hd">
	<h1>Page Header</h1>
	<p>
		<a href="index.html">Rows</a> |
		<a href="cols.html">Columns</a> |
		<strong>Single</strong> |
		<a href="rows-basic.html">Basic Rows</a> |
		<a href="cols-basic.html">Basic Columns</a> |
		<a href="rows-fixed.html">Fixed-size Rows</a> |
		<a href="cols-fixed.html">Fixed-size Columns</a>
	</p>
	<p>
		<a href="../yuidoc/module_gallery-layout.html">Documentation</a> |
		<a href="/yui3-gallery/">Project List</a>
	</p>
</div>

<!-- visibility:hidden will be removed once the layout has been calculated -->
<div class="layout-bd" style="visibility:hidden;">
	<div class="layout-module-row height:20%">
		<div class="layout-module">
			<div class="layout-m-hd">
				<p>DataTable Example</p>
			</div>
			<div id="table-bd" class="layout-m-bd datatable-m-bd">
				<div id="table"></div>
			</div>
			<div class="layout-m-ft">
				<div id="pg"></div>
			</div>
		</div>
	</div>
</div>

<!-- visibility:hidden will be removed once the layout has been calculated -->
<div class="layout-ft" style="visibility:hidden;">
	<p>Page Footer</p>
</div>

<script type="text/javascript">
YUI({
//	filter: 'raw', combine: false,
	gallery: 'gallery-2012.01.11-21-03'
}).use(
	'gallery-layout',
	'datatable-datasource', 'datatable-scroll',
	'gallery-paginator',
function(Y) {
"use strict";

	var page_layout = new Y.PageLayout();

// show something interesting in the module

	function sendRequest()
	{
		table.datasource.load(
		{
			request: pg.getState()
		});
	}

// Raw data

	var data =
	[
		{id:'n1', year:1950, quantity:10, title:"The Lion, the Witch and the Wardrobe"},
		{id:'n2', year:1951, quantity:5, title:"Prince Caspian: The Return to Narnia"},
		{id:'n3', year:1952, quantity:2, title:"The Voyage of the Dawn Treader"},
		{id:'n4', year:1953, quantity:6, title:"The Silver Chair"},
		{id:'n5', year:1954, quantity:9, title:"The Horse and His Boy"},
		{id:'n6', year:1955, quantity:4, title:"The Magician's Nephew"},
		{id:'n7', year:1956, quantity:8, title:"The Last Battle"},
		{id:'lsf1', year:1938, quantity:10, title:"Out of the Silent Planet"},
		{id:'lsf2', year:1943, quantity:5, title:"Perelandra"},
		{id:'lsf3', year:1945, quantity:2, title:"That Hideous Strength"},
		{id:'p1', year:1995, quantity:7, title:"Northern Lights"},
		{id:'p2', year:1997, quantity:5, title:"The Subtle Knife"},
		{id:'p3', year:2000, quantity:8, title:"The Amber Spyglass"},
		{id:'t0', year:1937, quantity:5, title:"The Hobbit"},
		{id:'t1', year:1955, quantity:12, title:"The Fellowship of the Ring"},
		{id:'t2', year:1955, quantity:0, title:"The Two Towers"},
		{id:'t3', year:1955, quantity:8, title:"The Return of the King"},
		{id:'pd', year:1966, quantity:5, title:"Do Androids Dream of Electric Sheep?"},
		{id:'h1', year:1959, quantity:4, title:"Starship Troopers"},
		{id:'h2', year:1961, quantity:7, title:"Stranger in a Strange Land"},
		{id:'h3', year:1966, quantity:3, title:"The Moon Is a Harsh Mistress"},
		{id:'v1', year:1946, quantity:3, title:"Slan"},
		{id:'v2', year:1950, quantity:5, title:"The Voyage of the Space Beagle"},
		{id:'v3', year:1970, quantity:8, title:"Quest for the Future"},
		{id:'d1', year:1859, quantity:5, title:"On the Origin of Species by Means of Natural Selection, or the Preservation of Favoured Races in the Struggle for Life"},
		{id:'d2', year:1881, quantity:2, title:"The Formation of Vegetable Mould through the Action of Worms"},
		{id:'e1', year:1905, quantity:8, title:"On a Heuristic Viewpoint Concerning the Production and Transformation of Light"},
		{id:'e2', year:1905, quantity:5, title:"On the Electrodynamics of Moving Bodies"},
		{id:'e3', year:1917, quantity:7, title:"Kosmologische Betrachtungen zur allgemeinen Relativit&auml;tstheorie"},
		{id:'e4', year:1935, quantity:3, title:"Can Quantum-Mechanical Description of Physical Reality Be Considered Complete?"},
		{id:'g1', year:1610, quantity:5, title:"Sidereus Nuncius"},
		{id:'g2', year:1615, quantity:2, title:"Letter to the Grand Duchess Christina"},
		{id:'g3', year:1632, quantity:6, title:"Dialogo sopra i due massimi sistemi del mondo"},
		{id:'i1', year:1671, quantity:7, title:"Method of Fluxions"},
		{id:'i2', year:1687, quantity:4, title:"Philosophi&aelig; Naturalis Principia Mathematica"},
		{id:'i3', year:1704, quantity:3, title:"Opticks"}
	];

// Data Source

	// extend local data source to understand pagination

	function CustomDataSource()
	{
		CustomDataSource.superclass.constructor.apply(this, arguments);
	}

	CustomDataSource.NAME = "customdatasource";

	Y.extend(CustomDataSource, Y.DataSource.Local,
	{
		_defDataFn: function(e)
		{
			var response =
			{
				results: e.data.slice(e.request.recordOffset, e.request.recordOffset + e.request.rowsPerPage),
				meta:
				{
					totalRecords: data.length
				}
			};

			this.fire("response", Y.mix({response: response}, e));
		}
	});

	// create data source

	var ds = new CustomDataSource({source: data});

// Paginator

	function updatePaginator(
		/* object */	state)
	{
		this.setPage(state.page, true);
		this.setRowsPerPage(state.rowsPerPage, true);
		sendRequest();
	}

	var pg = new Y.Paginator(
	{
		totalRecords: 10,
		rowsPerPage: 10,
		template: '{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} <span class="rpp">Rows per page:</span> {RowsPerPageDropdown}',
		rowsPerPageOptions:    [5,10,50],
		firstPageLinkLabel:    '|&lt;',
		previousPageLinkLabel: '&lt;',
		nextPageLinkLabel:     '&gt;',
		lastPageLinkLabel:     '&gt;|'
	});
	pg.on('changeRequest', updatePaginator);
	pg.render('#pg');

	ds.on('response', function(e)
	{
		pg.setTotalRecords(e.response.meta.totalRecords, true);
		pg.render();

		page_layout.elementResized('#table');

		if (first_request)	// hack to force data table to render correctly
		{
			first_request = false;
			Y.later(100, null, sendRequest);
		}
	});

// DataTable

	var cols =
	[
		{ key: 'title', label: 'Title', quickEdit: true },
		{ key: 'year', label: 'Year' },
		{ key: 'quantity', label: 'Quantity',
			quickEdit:
			{
				copyDown:   true,
				validation: { css: 'yiv-required yiv-integer:[0,]' }
			}
		}
	];

	var table = new Y.DataTable.Base({columnset: cols});
	table.plug(Y.Plugin.DataTableDataSource, {datasource: ds});
	table.plug(Y.Plugin.DataTableScroll,
	{
		width:  '100%',
		height: '10px'	// force scrollbar on .yui3-datatable-bd
	});

	table.render('#table');

	page_layout.on('beforeResizeModule', function(e)
	{
		var node = e.details[0];
		if (node.get('id') == 'table-bd' && e.details[1] == 'auto')
		{
			node.one('.yui3-datatable-bd').setStyle('height', 'auto');
		}
	});

	page_layout.on('afterResizeModule', function(e)
	{
		var node = e.details[0];
		if (node.get('id') == 'table-bd')
		{
			var h = e.details[1] - node.one('.yui3-datatable-hd').totalHeight();
			Y.one('.yui3-datatable-bd').setStyle('height', h+'px');
		}
	});

	var first_request = true;
	sendRequest();
});
</script>

</body>
</html>
