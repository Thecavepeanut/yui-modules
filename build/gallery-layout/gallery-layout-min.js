YUI.add("gallery-layout",function(a){function l(){l.superclass.constructor.apply(this,arguments);}l.NAME="pagelayout";l.FIT_TO_VIEWPORT=0;l.FIT_TO_CONTENT=1;l.ATTRS={mode:{value:l.FIT_TO_VIEWPORT,validator:function(m){return(m===l.FIT_TO_VIEWPORT||m===l.FIT_TO_CONTENT);}},minWidth:{value:73,validator:function(m){return(a.Lang.isNumber(m)&&m>0);}},minHeight:{value:44,validator:function(m){return(a.Lang.isNumber(m)&&m>0);}},stickyFooter:{value:false,validator:a.Lang.isBoolean},matchColumnHeights:{value:true,validator:a.Lang.isBoolean}};l.page_header_class="layout-hd";l.page_body_class="layout-bd";l.page_footer_class="layout-ft";l.module_rows_class="layout-module-row";l.module_cols_class="layout-module-col";l.module_class="layout-module";l.module_header_class="layout-m-hd";l.module_body_class="layout-m-bd";l.module_footer_class="layout-m-ft";l.not_managed_class="layout-not-managed";l.collapse_vert_nub_class="layout-vert-collapse-nub";l.collapse_left_nub_class="layout-left-collapse-nub";l.collapse_right_nub_class="layout-right-collapse-nub";l.expand_vert_nub_class="layout-vert-expand-nub";l.expand_left_nub_class="layout-left-expand-nub";l.expand_right_nub_class="layout-right-expand-nub";l.collapsed_vert_class="layout-collapsed-vert";l.collapsed_horiz_class="layout-collapsed-horiz";l.min_module_height=10;l.unmanaged_size=-1;var h=/\bFIT_TO_[A-Z_]+/,c=/(?:^|\s)height:([0-9]+)%/,f=/(?:^|\s)width:([0-9]+)%/,d=100;function g(r,q){var p=a.map(r,function(u){if(u.hasClass(l.not_managed_class)){return l.unmanaged_size;}var t=u.get("className").match(q);return(t&&t.length?parseInt(t[1],10):0);});var s=a.reduce(p,[0,0],function(u,t){if(t>0){u[0]+=t;}else{if(t===0){u[1]++;}}return u;});var o=s[0],n=s[1];if(n>0){var m=Math.max((100-o)/n,10);p=a.map(p,function(t){return(t===0?m:t);});o=a.reduce(p,0,function(v,u,t){return(u<0?v:v+u);});}return a.map(p,function(t){return(t>0?t*(100/o):t);});}function j(){this.body_container.replaceClass("FIT_TO_(VIEWPORT|CONTENT)",this.get("mode")===l.FIT_TO_VIEWPORT?"FIT_TO_VIEWPORT":"FIT_TO_CONTENT");}function e(){if(!this.footer_container){return;}if(this.get("mode")===l.FIT_TO_VIEWPORT||this.get("stickyFooter")){this.body_container.get("parentNode").insertBefore(this.footer_container,this.body_container.next(function(m){return m.get("tagName").toLowerCase()!="script";}));}else{this.body_container.appendChild(this.footer_container);}}function b(){if(this.layout_plugin){this.layout_plugin.resize(this);}}function k(o){var n=o.currentTarget;function m(t,q){var s=n.getAncestorByClassName(this.layout_plugin.collapse_classes[t]);if(s&&s.hasClass(q)){var r=this._analyzeModule(s);this.fire("beforeExpandModule",r.bd);s.removeClass(q);b.call(this);this.fire("afterExpandModule",r.bd);}}if(n.hasClass(l.expand_vert_nub_class)){m.call(this,"vert_parent_class",l.collapsed_vert_class);}else{m.call(this,"horiz_parent_class",l.collapsed_horiz_class);}}function i(n){var m=n.currentTarget;function o(t,q){var s=m.getAncestorByClassName(this.layout_plugin.collapse_classes[t]);if(s&&!s.hasClass(q)){var r=this._analyzeModule(s);this.fire("beforeCollapseModule",r.bd);s.addClass(q);b.call(this);this.fire("afterCollapseModule",r.bd);}}if(m.hasClass(l.collapse_vert_nub_class)){o.call(this,"vert_parent_class",l.collapsed_vert_class);}else{o.call(this,"horiz_parent_class",l.collapsed_horiz_class);}}a.extend(l,a.Base,{initializer:function(){this.body_rows={rows:[],modules:[],row_heights:[],col_widths:[]};this.viewport={w:0,h:0,bcw:0,};var p=a.one("body").get("children");var q=p.filter("."+l.page_header_class);if(q.size()>1){throw Error("There must be at most one div with class "+l.page_header_class);}this.header_container=(q.isEmpty()?null:q.item(0));q=p.filter("."+l.page_body_class);if(q.size()!=1){throw Error("There must be exactly one div with class "+l.page_body_class);}this.body_container=q.item(0);this.body_horiz_mbp=this.body_container.horizMarginBorderPadding();this.body_vert_mbp=this.body_container.vertMarginBorderPadding();var n=this.body_container.get("className").match(h);if(n&&n.length){this.set("mode",l[n[0]]);}q=p.filter("."+l.page_footer_class);if(q.size()>1){throw Error("There must be at most one div with class "+l.page_footer_class);}this.footer_container=(q.isEmpty()?null:q.item(0));j.call(this);e.call(this);this.rescanBody();var o=a.one(a.config.win);o.on("resize",b,this);b.call(this);this.after("modeChange",function(){j.call(this);if(this.body_container){this.body_container.scrollTop=0;}e.call(this);b.call(this);});this.after("minWidthChange",b);this.after("minHeightChange",b);this.after("stickyFooterChange",function(){e.call(this);b.call(this);});this.after("matchColumnHeightsChange",b);},rescanBody:function(){a.detach("PageLayoutCollapse|click");this.body_rows.rows=this.body_container.all("div."+l.module_rows_class);this.body_rows.modules=[];this.body_rows.row_heights=[];this.body_rows.col_widths=[];var m="("+l.collapse_vert_nub_class+"|"+l.collapse_left_nub_class+"|"+l.collapse_right_nub_class+")";var n="("+l.expand_vert_nub_class+"|"+l.expand_left_nub_class+"|"+l.expand_right_nub_class+")";var o=this.body_rows.rows.size();a.each(this.body_rows.rows,function(q){q.generateID();this.body_rows.row_heights.push(100/o);var p=q.all("div."+l.module_class);if(p.isEmpty()){this.body_rows.rows=[];this.body_rows.modules=[];this.body_rows.row_heights=[];throw Error("There must be at least one "+l.module_class+" inside "+l.module_rows_class+".");}this.body_rows.modules.push(p);a.each(p,function(s){var r=s.getFirstElementByClassName(m);if(r){a.on("PageLayoutCollapse|click",i,r,this);}r=s.getFirstElementByClassName(n);if(r){a.on("PageLayoutCollapse|click",k,r,this);}},this);this.body_rows.col_widths.push(g(p,f));},this);this.body_rows.row_heights=g(this.body_rows.rows,c);this.layout_plugin=a.PageLayoutRows;b.call(this);},getHeaderHeight:function(){return(this.header_container?this.header_container.get("offsetHeight"):0);},getHeaderContainer:function(){return this.header_container;},getBodyHeight:function(){return this.body_container.get("offsetHeight");
},getBodyContainer:function(){return this.body_container;},getFooterHeight:function(){return(this.get("stickyFooter")&&this.footer_container?this.footer_container.get("offsetHeight"):0);},getFooterContainer:function(){return this.footer_container;},moduleIsCollapsed:function(n){var m="("+l.collapsed_horiz_class+"|"+l.collapses_vert_class+")";n=a.one(n);if(n.getFirstElementByClassName(this.layout_plugin.collapse_classes.collapse_parent_pattern)){n=n.get("parentNode");}return n.hasClass(m);},expandModule:function(o){o=a.one(o);var n=o.getFirstElementByClassName(l.expand_vert_nub_class);if(!n){var m="("+l.expand_left_nub_class+"|"+l.expand_right_nub_class+")";n=o.getFirstElementByClassName(m);}if(n){k.call(this,{currentTarget:n});}},collapseModule:function(n){n=a.one(n);var m=n.getFirstElementByClassName(l.collapse_vert_nub_class);if(!m){var o="("+l.collapse_left_nub_class+"|"+l.collapse_right_nub_class+")";m=n.getFirstElementByClassName(o);}if(m){i.call(this,{currentTarget:m});}},toggleModule:function(m){m=a.one(m);if(this.moduleIsCollapsed(m)){this.expandModule(m);}else{this.collapseModule(m);}},elementResized:function(m){m=a.one(m);if((this.header_container&&this.header_container.contains(m))||this.body_container.contains(m)||(this.footer_container&&this.footer_container.contains(m))){if(this.refresh_timer!==null){this.refresh_timer.cancel();}var n=(new Date()).getTime();this.refresh_timer=a.later(d,this,function(){this.refresh_timer=null;var o=(new Date()).getTime();if(o>n+2*d){this.elementResized(m);}else{b.call(this);}});return true;}else{return false;}},_analyzeModule:function(n){var m={root:n,hd:null,bd:null,ft:null};var p=n.one("."+l.module_body_class);if(!p){return m;}var o=p.siblings().filter("."+l.module_body_class);o.unshift(p);m.bd=o.find(function(q){return(q.get("offsetWidth")>0);});if(m.bd){m.hd=m.bd.siblings().filter("."+l.module_header_class).item(0);m.ft=m.bd.siblings().filter("."+l.module_footer_class).item(0);}return m;},_checkViewportSize:function(){if(this.body_container.get("winWidth")!=this.viewport.w||this.body_container.get("winHeight")!=this.viewport.h||this.body_container.get("clientWidth")!=this.viewport.bcw){b.call(this);}else{this.fire("afterReflow");}},_setWidth:function(n,m){n.root.setStyle("width",m+"px");}});a.PageLayout=l;},"@VERSION@",{requires:["base","gallery-funcprog","gallery-node-optimizations","gallery-dimensions"],optional:["gallery-layout-rows","gallery-layout-cols"]});