YUI.add("gallery-formmgr",function(D){function L(Q,P){if(arguments.length===0){return;}if(!P){P={};}this.form_name=Q;this.status_node=D.one(P.status_node);this.enabled=true;this.default_value_map=P.default_value_map;this.validation={fn:{},regex:{}};this.validation_msgs={};this.has_messages=false;this.has_errors=false;this.button_list=[];this.user_button_list=[];this.has_file_inputs=false;}var E="(?:^|\\s)(?:";var H=")(?:\\s|$)";L.row_marker_class="formmgr-row";L.field_marker_class="formmgr-field";L.status_marker_class="formmgr-message-text";L.status_none_class="formmgr-status-hidden";L.status_success_class="formmgr-status-success";L.status_failure_class="formmgr-status-failure";L.row_status_prefix="formmgr-has";var G;var O;var N;function B(){if(!G){G=L.status_success_class+"|"+L.status_failure_class;}return G;}function C(){if(!O){O=L.row_status_prefix+"([^\\s]+)";}return O;}function A(){if(!N){N=new RegExp(E+C()+H);}return N;}L.status_order=["error","warn","success","info"];L.getStatusPrecedence=function(P){for(var Q=0;Q<L.status_order.length;Q++){if(P==L.status_order[Q]){return Q;}}return L.status_order.length;};L.statusTakesPrecendence=function(Q,P){return(!Q||L.getStatusPrecedence(P)<L.getStatusPrecedence(Q));};L.getElementStatus=function(Q){var P=D.one(Q).get("className").match(A());return(P&&P.length>1?P[1]:false);};function F(P){if(D.Lang.isString(P)){return P.replace(/^#/,"");}else{if(P instanceof D.Node){return P.get("id");}else{return P.id;}}}function M(Q,P){Q=D.Node.getDOMNode(D.one(Q));while(Q&&!D.DOM.hasClass(Q,P)){Q=Q.parentNode;if(!Q||!Q.tagName){return null;}}return D.one(Q);}function K(P,Q){P=D.Node.getDOMNode(D.one(P));Q=Q.toLowerCase();while(P&&P.tagName.toLowerCase()!=Q){P=P.parentNode;if(!P||!P.tagName){return null;}}return D.one(P);}L.cleanValues=function(T){var S=false;for(var Q=0;Q<T.length;Q++){var P=T[Q];var R=P.type&&P.type.toLowerCase();if(R=="file"){S=true;}else{if(R=="select-multiple"){}else{if(P.value){P.value=D.Lang.trim(P.value);}}}}return S;};function I(){var T=(this.button_list.length===0);for(var S=0;S<this.form.elements.length;S++){var W=this.form.elements[S];var R=W.tagName.toLowerCase();var U=(W.type?W.type.toLowerCase():null);if(T&&(U=="submit"||U=="reset"||R=="button")){this.button_list.push(W);}if(!W.name){continue;}var P=this.default_value_map[W.name];if(R=="input"&&U=="file"){W.value="";}else{if(D.Lang.isUndefined(P)){if(R=="input"&&(U=="password"||U=="text")){this.default_value_map[W.name]=W.value;}else{if(R=="input"&&U=="checkbox"){this.default_value_map[W.name]=(W.checked?W.value:"");}else{if(R=="input"&&U=="radio"){var V=this.form[W.name];if(V&&!V.length){this.default_value_map[W.name]=V.value;}else{if(V){this.default_value_map[W.name]=V[0].value;for(var Q=0;Q<V.length;Q++){if(V[Q].checked){this.default_value_map[W.name]=V[Q].value;break;}}}}}else{if((R=="select"&&U=="select-one")||R=="textarea"){this.default_value_map[W.name]=W.value;}}}}}else{if(R=="input"&&(U=="password"||U=="text")){W.value=P;}else{if(R=="input"&&(U=="checkbox"||U=="radio")){W.checked=(W.value==P);}else{if(R=="select"&&U=="select-one"){W.value=P;if(W.selectedIndex>=0&&W.options[W.selectedIndex].value!==P.toString()){W.selectedIndex=-1;}}else{if(R=="textarea"){W.value=P;}}}}}}}}L.prototype={getForm:function(){if(!this.form){this.form=D.config.doc.forms[this.form_name];}return this.form;},hasFileInputs:function(){return this.has_file_inputs;},setDefaultValues:function(P){this.default_value_map=P;},setDefaultValue:function(Q,P){this.default_value_map[Q]=P;},saveCurrentValuesAsDefault:function(){this.default_value_map={};this.button_list=[];I.call(this);},setFunction:function(Q,P){this.validation.fn[F(Q)]=P;},setRegex:function(R,Q,P){R=F(R);if(D.Lang.isString(Q)){this.validation.regex[R]=new RegExp(Q,P);}else{this.validation.regex[R]=Q;}if(!this.validation_msgs[R]||!this.validation_msgs[R].regex){}},setErrorMessages:function(Q,P){this.validation_msgs[F(Q)]=P;},addErrorMessage:function(R,P,Q){R=F(R);if(!this.validation_msgs[R]){this.validation_msgs[R]={};}this.validation_msgs[R][P]=Q;},clearForm:function(){this.clearMessages();this.form.reset();this.postPopulateForm();},populateForm:function(){if(!this.default_value_map){this.default_value_map={};}this.clearMessages();I.call(this);this.postPopulateForm();},postPopulateForm:function(){},isChanged:function(){for(var R=0;R<this.form.elements.length;R++){var U=this.form.elements[R];if(!U.name){continue;}var S=(U.type?U.type.toLowerCase():null);var Q=U.tagName.toLowerCase();var P=this.default_value_map[U.name];if(P===null||typeof P==="undefined"){P="";}if(Q=="input"&&S=="file"){if(U.value){return true;}}else{if(Q=="input"&&(S=="password"||S=="text"||S=="file")){if(U.value!=P){return true;}}else{if(Q=="input"&&(S=="checkbox"||S=="radio")){var T=(U.value==P);if((T&&!U.checked)||(!T&&U.checked)){return true;}}else{if((Q=="select"&&S=="select-one")||Q=="textarea"){if(U.value!=P){return true;}}}}}}return false;},prepareForm:function(){this.getForm();if(!this.prePrepareForm.apply(this,arguments)){return false;}this.populateForm();return this.postPrepareForm.apply(this,arguments);},prePrepareForm:function(){return true;},postPrepareForm:function(){return true;},initFocus:function(){for(var R=0;R<this.form.elements.length;R++){var T=this.form.elements[R];if(T.disabled||T.offsetHeight===0){continue;}var P=T.tagName.toLowerCase();var S=(T.type?T.type.toLowerCase():null);if((P=="input"&&(S=="file"||S=="password"||S=="text"))||P=="textarea"){try{T.focus();}catch(Q){}T.select();break;}}},validateForm:function(){this.clearMessages();var Q=true;var V=this.form.elements;this.has_file_inputs=L.cleanValues(V);for(var R=0;R<V.length;R++){var W=V[R].id;var P=this.validation_msgs[W];var U=L.validateFromCSSData(V[R],P);if(U.error){this.displayMessage(V[R],U.error,"error");Q=false;continue;}if(U.keepGoing){if(this.validation.regex[W]&&!this.validation.regex[W].test(V[R].value)){this.displayMessage(V[R],P?P.regex:null,"error");Q=false;continue;}}var T=this.validation.fn[W];
var S=this;if(D.Lang.isFunction(T)){}else{if(D.Lang.isString(T)){T=S[T];}else{if(T&&T.scope){S=T.scope;T=(D.Lang.isString(T.fn)?S[T.fn]:T.fn);}else{T=null;}}}if(T&&!T.call(S,this.form,D.one(V[R]))){Q=false;continue;}}if(!this.postValidateForm(this.form)){Q=false;}if(!Q){this.notifyErrors();}return Q;},postValidateForm:function(P){return true;},registerButton:function(P){var Q={e:D.one(P)};this.user_button_list.push(Q);},isFormEnabled:function(){return this.enabled;},enableForm:function(){this.setFormEnabled(true);},disableForm:function(){this.setFormEnabled(false);},setFormEnabled:function(P){this.enabled=P;var R=!P;for(var Q=0;Q<this.button_list.length;Q++){this.button_list[Q].disabled=R;}for(Q=0;Q<this.user_button_list.length;Q++){var S=this.user_button_list[Q];S.e.set("disabled",R);}},hasMessages:function(){return this.has_messages;},hasErrors:function(){return this.has_errors;},getRowStatus:function(Q){var P=M(Q,L.row_marker_class);return L.getElementStatus(P);},clearMessages:function(){this.has_messages=false;this.has_errors=false;if(this.status_node){this.status_node.set("innerHTML","");this.status_node.replaceClass(B(),L.status_none_class);}for(var Q=0;Q<this.form.elements.length;Q++){var T=this.form.elements[Q];var P=T.tagName.toLowerCase();var R=(T.type?T.type.toLowerCase():null);if(P=="button"||R=="submit"||R=="reset"){continue;}var S=M(T,L.row_marker_class);if(S&&S.hasClass(C())){S.all("."+L.status_marker_class).set("innerHTML","");S.removeClass(C());S.all("."+L.field_marker_class).removeClass(C());}}D.one(this.form).all("fieldset").removeClass(C());},displayMessage:function(T,Q,V,W){if(D.Lang.isUndefined(W)){W=true;}T=D.one(T);var P=M(T,L.row_marker_class);if(P&&L.statusTakesPrecendence(L.getElementStatus(P),V)){var S=P.all("."+L.field_marker_class);if(S){S.removeClass(C());}if(Q){P.one("."+L.status_marker_class).set("innerHTML",Q);}var R=L.row_status_prefix+V;P.replaceClass(C(),R);S=M(T,L.field_marker_class);if(S){S.replaceClass(C(),R);}var X=K(T,"fieldset");if(X&&L.statusTakesPrecendence(L.getElementStatus(X),V)){X.removeClass(C());X.addClass(L.row_status_prefix+V);}if(!this.has_messages&&W){P.scrollIntoView();try{T.focus();}catch(U){}}this.has_messages=true;if(V=="error"){this.has_errors=true;}return true;}return false;},notifyErrors:function(){this.displayFormMessage(L.Strings.validation_error,true,false);},displayFormMessage:function(R,Q,P){if(D.Lang.isUndefined(P)){P=true;}if(this.status_node){if(!this.status_node.innerHTML){this.status_node.replaceClass(L.status_none_class,(Q?L.status_failure_class:L.status_success_class));this.status_node.set("innerHTML",R);}if(P){this.status_node.scrollIntoView();}}else{}}};if(D.FormManager){for(var J in D.FormManager){if(D.FormManager.hasOwnProperty(J)){L[J]=D.FormManager[J];}}}D.FormManager=L;},"@VERSION@",{requires:["node-base","gallery-formmgr-css-validation"]});