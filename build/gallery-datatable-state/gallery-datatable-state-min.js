YUI.add("gallery-datatable-state",function(g){function d(h){d.superclass.constructor.call(this,h);}d.NAME="DataTableStatePlugin";d.NS="state";d.ATTRS={uniqueIdKey:{validator:g.Lang.isString},save:{value:[],validator:g.Lang.isArray}};function f(h,i){delete i[h];}function b(h){g.each(this.state,g.bind(f,null,h));}function e(){var h=this.get("host")._displayColumns;g.each(this.get("save"),function(i){i.column_index=g.Array.findIndexOf(h,function(j){return j.key===i.column;});if(i.column_index<0){b.call(this,i.column);}},this);}function a(){var i=this.get("host");var h=i.data.size();var j=this.get("uniqueIdKey");g.each(this.get("save"),function(n){if(n.column_index<0){return;}for(var l=0;l<h;l++){var p=null;var k=i.getCell([l,n.column_index]);if(k){if(n.node){var m=k.one(n.node);if(m){p=m.get(n.key);}}else{if(n.widget){var o=g.Widget.getByNode(k.one(n.widget));if(o){p=o.get(n.key);}}}}var q=i.getRecord(l);var r=q.get(j);if(!this.state[r]){this.state[r]={};}this.state[r][n.column]=p;}},this);}function c(){var i=this.get("host");var h=i.data.size();var j=this.get("uniqueIdKey");g.each(this.get("save"),function(n){if(n.column_index<0){return;}for(var l=0;l<h;l++){var r=i.getRecord(l);var q=this.state[r.get(j)];if(q){var p=q[n.column];var k=i.getCell([l,n.column_index]);if(k){if(n.node){var m=k.one(n.node);if(m){m.set(n.key,p);}}else{if(n.widget){var o=g.Widget.getByNode(k.one(n.widget));if(o){o.set(n.key,p);}}}}}}},this);}g.extend(d,g.Plugin.Base,{initializer:function(i){this.state={};this.on("uniqueIdKeyChange",function(){this.state={};});e.call(this);this.after("saveChange",e);this.afterHostEvent("columnsChange",e);var j=this.get("host");var h=this;var k=this.orig_syncUI=j.syncUI;j.syncUI=function(){a.call(h);k.apply(j,arguments);c.call(h);};this.onHostEvent("dataChange",a);this.afterHostEvent("dataChange",function(){g.later(0,this,c);});},destructor:function(){this.get("host").syncUI=this.orig_syncUI;},getState:function(){a.call(this);return this.state;}});g.namespace("Plugin");g.Plugin.DataTableState=d;},"@VERSION@",{requires:["datatable","plugin","gallery-funcprog","gallery-node-optimizations"]});